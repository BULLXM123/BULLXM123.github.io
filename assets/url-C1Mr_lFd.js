import{u as C}from"./index-DyiAMGIZ.js";import{a as y}from"./utils-C42QaX6I.js";import{C as I}from"./CloudUpload-jfh8uwlP.js";import{u as x,k as R,m,l as i,q as F,p as S,N as V,r as k}from"./ui-vendor-bYSxkbvo.js";import{k as B,r as v,e as q,X as g,$ as t,N as r,Z as l,V as n,Y as z,j as U,U as b}from"./vue-vendor-CjWJpnUV.js";import{_ as L}from"./plugin-vueexport-helper-DlAUqK2U.js";const M={class:"optional-fields"},O={class:"form-actions"},$=B({__name:"url",emits:["cancel","ok"],setup(h,{emit:_}){const f=C(),u=x(),d=v(),p=v(!1),c=_,N=()=>{c("cancel")},e=q({name:"",url:"",server:"",wsUrl:""}),w={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:1,max:50,message:"名称长度应在1到50个字符之间",trigger:"blur"}],url:[{required:!0,message:"请输入Token获取地址",trigger:"blur"},{type:"url",message:"请输入有效的URL地址",trigger:"blur"}]},T=async()=>{if(d.value){try{await d.value.validate()}catch{u.error("请修正表单中的错误后再提交");return}p.value=!0;try{const s=await y.get(e.url);if(s.status===200&&s.data&&s.data.token){const a={name:e.name,token:s.data.token,server:e.server||"未知",wsUrl:e.wsUrl||"",id:Date.now().toString(),sourceUrl:e.url,importMethod:"url"};f.addToken(a),u.success("Token添加成功"),e.name="",e.url="",e.server="",e.wsUrl="",c("ok")}else u.error("接口返回数据格式不正确，未找到token字段")}catch{u.error("获取Token失败，请检查URL地址或网络连接")}finally{p.value=!1}}};return(s,a)=>(b(),g(r(R),{ref_key:"urlFormRef",ref:d,model:e,rules:w,"label-placement":"top",size:"large"},{default:t(()=>[l(r(i),{label:"游戏角色名称",path:"name"},{default:t(()=>[l(r(m),{value:e.name,"onUpdate:value":a[0]||(a[0]=o=>e.name=o),placeholder:"例如：主号战士",clearable:""},null,8,["value"])]),_:1}),l(r(i),{label:"Token获取地址",path:"url"},{feedback:t(()=>[...a[4]||(a[4]=[n("div",{class:"form-tips"},[n("span",{class:"form-tip"}," 接口应返回包含token字段的JSON数据 "),n("span",{class:"form-tip cors-tip"}," 注意：如果是跨域URL，服务器需要支持CORS，否则会被浏览器阻止 ")],-1)])]),default:t(()=>[l(r(m),{value:e.url,"onUpdate:value":a[1]||(a[1]=o=>e.url=o),placeholder:"输入API接口地址...",clearable:""},null,8,["value"])]),_:1}),l(r(S),null,{default:t(()=>[l(r(F),{title:"角色详情 (可选)",name:"optional"},{default:t(()=>[n("div",M,[l(r(i),{label:"服务器"},{default:t(()=>[l(r(m),{value:e.server,"onUpdate:value":a[2]||(a[2]=o=>e.server=o),placeholder:"服务器名称"},null,8,["value"])]),_:1}),l(r(i),{label:"自定义连接地址"},{default:t(()=>[l(r(m),{value:e.wsUrl,"onUpdate:value":a[3]||(a[3]=o=>e.wsUrl=o),placeholder:"留空使用默认连接"},null,8,["value"])]),_:1})])]),_:1})]),_:1}),n("div",O,[l(r(k),{type:"primary",size:"large",block:"",loading:p.value,onClick:T},{icon:t(()=>[l(r(V),null,{default:t(()=>[l(r(I))]),_:1})]),default:t(()=>[a[5]||(a[5]=U(" 获取并添加Token ",-1))]),_:1},8,["loading"]),r(f).hasTokens?(b(),g(r(k),{key:0,size:"large",block:"",onClick:N},{default:t(()=>[...a[6]||(a[6]=[U(" 取消 ",-1)])]),_:1})):z("",!0)])]),_:1},8,["model"]))}}),Y=L($,[["__scopeId","data-v-7daf6a07"]]);export{Y as default};
