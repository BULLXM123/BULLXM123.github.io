import{s as useTokenStore,p as useMessage,n as computed,r as ref,v as reactive,x as watch,o as onMounted,Z as onBeforeUnmount,R as nextTick,c as createElementBlock,a as createBaseVNode,b as createVNode,w as withCtx,d as resolveComponent,i as openBlock,j as createTextVNode,t as toDisplayString,F as Fragment,g as renderList,e as createBlock,B as withModifiers,u as unref,I as normalizeStyle,z as normalizeClass,y as createCommentVNode,a1 as preloadQuestions}from"./index-Dnc0zSbg.js";import{D as DailyTaskRunner}from"./dailyTaskRunner-C7mpZvJx.js";import{_ as _export_sfc}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{S as Settings}from"./Settings-DdAh0sll.js";const _hoisted_1={class:"batch-daily-tasks"},_hoisted_2={class:"main-layout"},_hoisted_3={class:"left-column"},_hoisted_4={class:"page-header"},_hoisted_5={class:"actions"},_hoisted_6={class:"token-row"},_hoisted_7={class:"token-item"},_hoisted_8={class:"task-preview",style:{margin:"16px 0",padding:"16px",border:"1px solid #e5e7eb","border-radius":"8px","background-color":"#fafafa"}},_hoisted_9={key:0,style:{display:"flex","flex-direction":"column","align-items":"center",padding:"12px","background-color":"white","border-radius":"6px","box-shadow":"0 2px 8px rgba(0, 0, 0, 0.1)"}},_hoisted_10={style:{"font-size":"16px","font-weight":"bold","margin-bottom":"8px"}},_hoisted_11={key:1,style:{"text-align":"center",padding:"24px",color:"#6b7280","font-style":"italic"}},_hoisted_12={key:0,class:"tasks-count"},_hoisted_13={key:1,class:"tasks-count"},_hoisted_14={class:"right-column"},_hoisted_15={class:"log-header-controls"},_hoisted_16={class:"time"},_hoisted_17={class:"message"},_hoisted_18={class:"settings-content"},_hoisted_19={class:"settings-grid"},_hoisted_20={class:"setting-item"},_hoisted_21={class:"setting-item"},_hoisted_22={class:"setting-item"},_hoisted_23={class:"setting-switches"},_hoisted_24={class:"switch-row"},_hoisted_25={class:"switch-row"},_hoisted_26={class:"switch-row"},_hoisted_27={class:"switch-row"},_hoisted_28={class:"switch-row"},_hoisted_29={class:"switch-row"},_hoisted_30={class:"switch-row"},_hoisted_31={class:"modal-actions",style:{"margin-top":"20px","text-align":"right"}},_hoisted_32={class:"settings-content"},_hoisted_33={class:"settings-grid"},_hoisted_34={key:0,class:"setting-item"},_hoisted_35={key:1,class:"setting-item"},_hoisted_36={class:"setting-item"},_hoisted_37={class:"modal-actions",style:{"margin-top":"20px","text-align":"right"}},_hoisted_38={class:"tasks-list",style:{"max-height":"600px","overflow-y":"auto"}},_hoisted_39={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},_hoisted_40={style:{"font-weight":"bold"}},_hoisted_41={style:{"margin-bottom":"4px"}},_hoisted_42={style:{"margin-bottom":"4px"}},_hoisted_43={style:{"margin-bottom":"4px"}},_hoisted_44={style:{"margin-bottom":"4px"}},_hoisted_45={style:{"margin-bottom":"8px"}},_hoisted_46={style:{display:"flex",gap:"8px"}},_hoisted_47={key:0,style:{"text-align":"center",padding:"24px",color:"#6b7280"}},_hoisted_48={class:"settings-content"},_hoisted_49={class:"settings-grid"},_hoisted_50={class:"setting-item"},_hoisted_51={class:"setting-item"},_hoisted_52={key:0,class:"setting-item"},_hoisted_53={key:1,class:"setting-item"},_hoisted_54={class:"setting-item"},_hoisted_55={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},_hoisted_56={class:"setting-item"},_hoisted_57={style:{display:"flex","justify-content":"space-between","align-items":"center","margin-bottom":"8px"}},_hoisted_58={class:"modal-actions",style:{"margin-top":"20px","text-align":"right"}},FISH_TARGET=320,ARENA_TARGET=240,FOUR_HOURS_MS=4*60*60*1e3,_sfc_main={__name:"BatchDailyTasks",setup(__props){const tokenStore=useTokenStore(),message=useMessage(),runner=new DailyTaskRunner(tokenStore),tokens=computed(()=>tokenStore.gameTokens),isCarActivityOpen=computed(()=>{const t=new Date().getDay();return t>=1&&t<=3}),ismengjingActivityOpen=computed(()=>{const t=new Date().getDay();return t===0||t===1||t===3||t===4}),isbaokuActivityOpen=computed(()=>{const t=new Date().getDay();return t!=1&&t!=2}),isarenaActivityOpen=computed(()=>{const t=new Date().getHours();return t>8&&t<22}),selectedTokens=ref([]),tokenStatus=ref({}),isRunning=ref(!1),shouldStop=ref(!1),showSettingsModal=ref(!1),currentSettingsTokenId=ref(null),currentSettingsTokenName=ref(""),currentSettings=reactive({arenaFormation:1,bossFormation:1,bossTimes:2,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0}),showHelperModal=ref(!1),helperType=ref("box"),helperSettings=reactive({boxType:2001,fishType:1,count:100}),helperModalTitle=computed(()=>({box:"批量开宝箱",fish:"批量钓鱼",recruit:"批量招募"})[helperType.value]||"批量助手"),scheduledTasks=ref([]),showTaskModal=ref(!1),showTasksModal=ref(!1),editingTask=ref(null),taskForm=reactive({name:"",runType:"daily",runTime:null,cronExpression:"",selectedTokens:[],selectedTasks:[],enabled:!0}),availableTasks=[{label:"领取挂机",value:"claimHangUpRewards"},{label:"一键加钟",value:"batchAddHangUpTime"},{label:"重置罐子",value:"resetBottles"},{label:"一键领取罐子",value:"batchlingguanzi"},{label:"一键爬塔",value:"climbTower"},{label:"一键答题",value:"batchStudy"},{label:"智能发车",value:"batchSmartSendCar"},{label:"一键收车",value:"batchClaimCars"},{label:"批量开箱",value:"batchOpenBox"},{label:"领取宝箱积分",value:"batchClaimBoxPointReward"},{label:"批量钓鱼",value:"batchFish"},{label:"批量招募",value:"batchRecruit"},{label:"一键宝库前3层",value:"batchbaoku13"},{label:"一键宝库4,5层",value:"batchbaoku45"},{label:"一键梦境",value:"batchmengjing"},{label:"一键俱乐部签到",value:"batchclubsign"},{label:"一键竞技场战斗3次",value:"batcharenafight"}],loadScheduledTasks=()=>{try{const t=localStorage.getItem("scheduledTasks");if(console.log("Raw localStorage data:",t),t){const e=JSON.parse(t);console.log("Parsed data:",e),console.log("Is array:",Array.isArray(e)),scheduledTasks.value=Array.isArray(e)?e:[],console.log("Loaded scheduled tasks:",scheduledTasks.value),console.log("Loaded tasks count:",scheduledTasks.value.length)}else console.log("No saved tasks in localStorage"),scheduledTasks.value=[]}catch(t){console.error("Failed to load scheduled tasks:",t),scheduledTasks.value=[]}},saveScheduledTasks=()=>{try{const t=JSON.stringify(scheduledTasks.value);console.log("Saving to localStorage:",t),localStorage.setItem("scheduledTasks",t);const e=localStorage.getItem("scheduledTasks");console.log("Verified saved data:",e),console.log("Saved scheduled tasks:",scheduledTasks.value),console.log("Saved tasks count:",scheduledTasks.value.length)}catch(t){console.error("Failed to save scheduled tasks:",t)}},openTaskModal=()=>{editingTask.value=null,Object.assign(taskForm,{name:"",runType:"daily",runTime:void 0,cronExpression:"",selectedTokens:[],selectedTasks:[],enabled:!0}),showTaskModal.value=!0},editTask=t=>{editingTask.value=t;const e={...t};if(t.runType==="daily"&&t.runTime&&typeof t.runTime=="string"){const[o,s]=t.runTime.split(":").map(Number),n=new Date;e.runTime=new Date(n.getFullYear(),n.getMonth(),n.getDate(),o,s)}Object.assign(taskForm,e),showTaskModal.value=!0},validateCronExpression=t=>{if(!t)return{valid:!1,message:"Cron表达式不能为空"};const e=t.split(" ").filter(Boolean);if(e.length!==5)return{valid:!1,message:"Cron表达式必须包含5个字段：分 时 日 月 周"};const[o,s,n,a,d]=e,r=(g,T,k,v)=>{if(!new RegExp("^(?:\\*|\\*/\\d+|[0-9]+/\\d+|(?:[0-9]+-?)*[0-9]+(?:,[0-9]+-?)*[0-9]+(?:/\\d+)?)$").test(g))return{valid:!1,message:`${v}字段格式错误`};if(/^\d+$/.test(g)){const f=parseInt(g);if(f<T||f>k)return{valid:!1,message:`${v}字段必须在${T}-${k}之间`}}return{valid:!0}},c=r(o,0,59,"分钟");if(!c.valid)return c;const l=r(s,0,23,"小时");if(!l.valid)return l;const p=r(n,1,31,"日期");if(!p.valid)return p;const u=r(a,1,12,"月份");if(!u.valid)return u;const m=r(d,0,7,"星期");return m.valid?{valid:!0,message:"Cron表达式格式正确"}:m},saveTask=()=>{var s;if(!taskForm.name){message.warning("请输入任务名称");return}if(taskForm.runType==="daily"&&!taskForm.runTime){message.warning("请选择运行时间");return}if(taskForm.runType==="cron"){if(!taskForm.cronExpression){message.warning("请输入Cron表达式");return}const n=validateCronExpression(taskForm.cronExpression);if(!n.valid){message.warning(n.message);return}}if(taskForm.selectedTokens.length===0){message.warning("请选择至少一个账号");return}if(taskForm.selectedTasks.length===0){message.warning("请选择至少一个任务");return}let t=null;taskForm.runType==="daily"&&taskForm.runTime&&(t=new Date(taskForm.runTime).toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"}));const e={id:((s=editingTask.value)==null?void 0:s.id)||"task_"+Date.now(),name:taskForm.name,runType:taskForm.runType,runTime:t,cronExpression:taskForm.runType==="cron"?taskForm.cronExpression:"",selectedTokens:[...taskForm.selectedTokens],selectedTasks:[...taskForm.selectedTasks],enabled:taskForm.enabled};let o=!editingTask.value;if(editingTask.value){const n=scheduledTasks.value.findIndex(a=>a.id===editingTask.value.id);n!==-1&&(scheduledTasks.value[n]=e)}else scheduledTasks.value.push(e);saveScheduledTasks(),console.log("After saving task, scheduledTasks.length:",scheduledTasks.value.length),console.log("Scheduled tasks:",scheduledTasks.value),addTaskSaveLog(e,o),showTaskModal.value=!1,message.success("定时任务已保存")},deleteTask=t=>{const e=scheduledTasks.value.find(o=>o.id===t);e&&(scheduledTasks.value=scheduledTasks.value.filter(o=>o.id!==t),saveScheduledTasks(),addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${e.name} 已删除 ===`,type:"info"}),message.success("定时任务已删除"))},toggleTaskEnabled=(t,e)=>{const o=scheduledTasks.value.find(s=>s.id===t);o&&(o.enabled=e,saveScheduledTasks(),message.success(`定时任务已${e?"启用":"禁用"}`),addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${o.name} 已${e?"启用":"禁用"} ===`,type:"info"}))},addTaskSaveLog=(t,e)=>{addLog({time:new Date().toLocaleTimeString(),message:`=== ${e?"新增":"修改"}定时任务: ${t.name} ===`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`运行类型: ${t.runType==="daily"?"每天固定时间":"Cron表达式"}`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`运行时间: ${t.runType==="daily"?t.runTime:t.cronExpression}`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`选中账号: ${t.selectedTokens.length} 个`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`选中任务: ${t.selectedTasks.length} 个`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`状态: ${t.enabled?"启用":"禁用"}`,type:"info"})},resetRunType=()=>{taskForm.runType==="daily"?taskForm.cronExpression="":taskForm.runTime=void 0},selectAllTokens=()=>{taskForm.selectedTokens=tokens.value.map(t=>t.id)},deselectAllTokens=()=>{taskForm.selectedTokens=[]},selectAllTasks=()=>{taskForm.selectedTasks=availableTasks.map(t=>t.value)},deselectAllTasks=()=>{taskForm.selectedTasks=[]},parseCronField=(t,e,o)=>{const s=new Set;if(t==="*"){for(let n=e;n<=o;n++)s.add(n);return Array.from(s)}if(t.includes("/")){const[n,a]=t.split("/"),d=parseInt(a);let r=e,c=o;if(n!=="*")if(n.includes("-")){const[l,p]=n.split("-").map(Number);r=l,c=p}else r=parseInt(n),c=o;for(let l=r;l<=c;l+=d)s.add(l);return Array.from(s)}if(t.includes("-")){const[n,a]=t.split("-").map(Number);for(let d=n;d<=a;d++)s.add(d);return Array.from(s)}if(t.includes(",")){const n=t.split(",");for(const a of n)s.add(parseInt(a));return Array.from(s)}return[parseInt(t)]},calculateNextExecutionTime=t=>{const e=new Date;if(t.runType==="daily"){const[o,s]=t.runTime.split(":").map(Number),n=new Date(e);return n.setHours(o,s,0,0),n<=e&&n.setDate(n.getDate()+1),n}else if(t.runType==="cron"){const o=t.cronExpression.split(" ").filter(Boolean);if(o.length<5)return null;const[s,n,a,d,r]=o,c=parseCronField(s,0,59),l=parseCronField(n,0,23),p=parseCronField(a,1,31),u=parseCronField(d,1,12),m=parseCronField(r,0,7);let g=new Date(e);g.setSeconds(0,0),g.setMinutes(g.getMinutes()+1);const T=new Date(e);for(T.setFullYear(T.getFullYear()+1);g<=T;){const k=g.getMinutes(),v=g.getHours(),w=g.getDate(),f=g.getMonth()+1,L=g.getDay();if(c.includes(k)&&l.includes(v)&&p.includes(w)&&u.includes(f)&&m.includes(L))return g;g.setMinutes(g.getMinutes()+1)}return null}return null},formatTimeDifference=t=>{const e=Math.floor(t/1e3),o=Math.floor(e/60),s=Math.floor(o/60),n=Math.floor(s/24),a=s%24,d=o%60,r=e%60;let c="";return n>0&&(c+=`${n}天`),(a>0||n>0)&&(c+=`${a}小时`),(d>0||a>0||n>0)&&(c+=`${d}分`),c+=`${r}秒`,c},taskCountdowns=ref({}),nextExecutionTimes=ref({}),updateCountdowns=()=>{const t=Date.now();scheduledTasks.value.forEach(e=>{if((!nextExecutionTimes.value[e.id]||nextExecutionTimes.value[e.id]<=t)&&(nextExecutionTimes.value[e.id]=calculateNextExecutionTime(e)),nextExecutionTimes.value[e.id]){const o=nextExecutionTimes.value[e.id]-t;taskCountdowns.value[e.id]={remainingTime:Math.max(0,o),formatted:formatTimeDifference(Math.max(0,o)),isNearExecution:o<5*60*1e3}}})},shortestCountdownTask=computed(()=>{if(scheduledTasks.value.length===0)return null;let t=null,e=1/0;return scheduledTasks.value.forEach(o=>{const s=taskCountdowns.value[o.id];s&&s.remainingTime<e&&(e=s.remainingTime,t={task:o,countdown:s})}),t});let countdownInterval=null;const startCountdown=()=>{countdownInterval&&clearInterval(countdownInterval),updateCountdowns(),countdownInterval=setInterval(updateCountdowns,1e3)};loadScheduledTasks(),watch(scheduledTasks,t=>{console.log("scheduledTasks changed:",t.length),console.log("New value:",t),nextExecutionTimes.value={},taskCountdowns.value={},updateCountdowns()},{deep:!0}),watch(()=>showTaskModal.value,t=>{t&&!taskForm.runTime&&(taskForm.runTime=void 0)}),onMounted(()=>{console.log("Component mounted, initial scheduledTasks:",scheduledTasks.value),console.log("Initial scheduledTasks length:",scheduledTasks.value.length),scheduleTaskExecution(),startCountdown()}),onBeforeUnmount(()=>{countdownInterval&&(clearInterval(countdownInterval),countdownInterval=null)});const scheduleTaskExecution=()=>{addLog({time:new Date().toLocaleTimeString(),message:"=== 定时任务调度服务已启动 ===",type:"info"});let t=null,e=null;const o=()=>{if(console.log(`[${new Date().toISOString()}] Task scheduler health check - running: ${t!==null}`),t||(console.error(`[${new Date().toISOString()}] Task scheduler interval is not running, restarting...`),s()),isRunning.value){const a=Date.now()-10*60*1e3;e&&e<a&&(console.error(`[${new Date().toISOString()}] isRunning has been true for more than 10 minutes, resetting to false`),isRunning.value=!1,addLog({time:new Date().toLocaleTimeString(),message:"=== 检测到任务执行超时，已重置isRunning状态 ===",type:"warning"}))}},s=()=>{t&&clearInterval(t),t=setInterval(()=>{try{const n=new Date,a=n.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit",second:"2-digit"});console.log(`[${new Date().toISOString()}] Checking scheduled tasks...`);const d=scheduledTasks.value.filter(r=>r.enabled);if(d.length===0){console.log(`[${new Date().toISOString()}] No enabled tasks to check`);return}d.forEach(r=>{let c=!1,l="";if(r.runType==="daily"){const p=r.runTime,u=n.toLocaleTimeString("zh-CN",{hour12:!1,hour:"2-digit",minute:"2-digit"});c=u===p,l=`currentTime=${u}, taskTime=${p}, match=${c}`}else if(r.runType==="cron")try{const p=r.cronExpression.split(" ").filter(Boolean);if(p.length<5){console.error(`[${new Date().toISOString()}] Invalid cron expression: ${r.cronExpression}, must have at least 5 parts`),addLog({time:a,message:`=== 定时任务 ${r.name} 的Cron表达式无效: ${r.cronExpression}，必须包含至少5个字段 ===`,type:"error"});return}const[u,m,g,T,k]=p,v=parseCronField(u,0,59),w=parseCronField(m,0,23),f=parseCronField(g,1,31),L=parseCronField(T,1,12),i=parseCronField(k,0,7),b=v.includes(n.getMinutes()),y=w.includes(n.getHours()),S=f.includes(n.getDate()),N=L.includes(n.getMonth()+1),h=i.includes(n.getDay());c=b&&y&&S&&N&&h,l=`minute=${b}, hour=${y}, dayOfMonth=${S}, month=${N}, dayOfWeek=${h}`}catch(p){console.error(`[${new Date().toISOString()}] Error parsing cron expression ${r.cronExpression}:`,p),addLog({time:a,message:`=== 解析定时任务 ${r.name} 的Cron表达式失败: ${p.message} ===`,type:"error"});return}if(console.log(`[${new Date().toISOString()}] Task ${r.name}: shouldRun=${c}, reason=${l}`),c){const p=`${r.id}_${n.getDate()}_${n.getHours()}_${n.getMinutes()}`;localStorage.getItem(`lastTaskExecution_${r.id}`)!==p?(localStorage.setItem(`lastTaskExecution_${r.id}`,p),console.log(`[${new Date().toISOString()}] Executing task ${r.name}`),e=Date.now(),executeScheduledTask(r)):(console.log(`[${new Date().toISOString()}] Task ${r.name} already executed in this minute, skipping`),addLog({time:a,message:`=== 任务 ${r.name} 本分钟内已执行，跳过 ===`,type:"info"}))}})}catch(n){console.error(`[${new Date().toISOString()}] Error in task scheduler:`,n),addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务调度服务发生错误: ${n.message} ===`,type:"error"})}},1e4),console.log(`[${new Date().toISOString()}] Task scheduler started with interval ID: ${t}`)};s(),setInterval(o,5*60*1e3),o(),onBeforeUnmount(()=>{console.log(`[${new Date().toISOString()}] Cleaning up task scheduler...`),t&&(clearInterval(t),t=null),addLog({time:new Date().toLocaleTimeString(),message:"=== 定时任务调度服务已停止 ===",type:"info"})})},verifyTaskDependencies=async task=>{var t;addLog({time:new Date().toLocaleTimeString(),message:`=== 开始验证定时任务 ${task.name} 的依赖 ===`,type:"info"});try{localStorage.setItem("test","test"),localStorage.removeItem("test"),addLog({time:new Date().toLocaleTimeString(),message:"✅ localStorage可用",type:"info"})}catch(e){return addLog({time:new Date().toLocaleTimeString(),message:`❌ localStorage不可用: ${e.message}`,type:"error"}),!1}if(!tokenStore||!tokenStore.gameTokens)return addLog({time:new Date().toLocaleTimeString(),message:"❌ Token存储不可用",type:"error"}),!1;for(const taskName of task.selectedTasks){const taskFunction=eval(taskName);if(typeof taskFunction!="function")return addLog({time:new Date().toLocaleTimeString(),message:`❌ 任务函数不存在: ${taskName}`,type:"error"}),!1}const checkWebSocketWithRetry=async(e,o=3,s=1e3)=>{var n;for(let a=0;a<o;a++){if(tokenStore.getWebSocketStatus(e)==="connected")return!0;if(a<o){const r=((n=tokenStore.gameTokens.find(c=>c.id===e))==null?void 0:n.name)||e;try{addLog({time:new Date().toLocaleTimeString(),message:`⏳ 账号 ${r} WebSocket未连接，尝试手动连接... (${a+1}/${o})`,type:"warning"});const c=tokenStore.gameTokens.find(l=>l.id===e);if(c&&c.token)typeof tokenStore.createWebSocketConnection=="function"?tokenStore.createWebSocketConnection(e,c.token):typeof tokenStore.selectToken=="function"&&tokenStore.selectToken(e,!0),await new Promise(l=>setTimeout(l,s));else{addLog({time:new Date().toLocaleTimeString(),message:`⚠️  账号 ${r} 缺少token信息，无法尝试手动连接`,type:"warning"});break}}catch(c){addLog({time:new Date().toLocaleTimeString(),message:`❌ 账号 ${r} 尝试手动连接失败: ${c.message}`,type:"error"}),await new Promise(l=>setTimeout(l,s))}}}return tokenStore.getWebSocketStatus(e)==="connected"},connectedTokens=[],disconnectedTokens=[];for(const e of task.selectedTokens){const o=((t=tokenStore.gameTokens.find(n=>n.id===e))==null?void 0:t.name)||e;await checkWebSocketWithRetry(e)?connectedTokens.push({id:e,name:o}):disconnectedTokens.push({id:e,name:o})}return connectedTokens.length>0&&addLog({time:new Date().toLocaleTimeString(),message:`✅ 已连接账号: ${connectedTokens.map(e=>e.name).join(", ")}`,type:"info"}),disconnectedTokens.length>0&&addLog({time:new Date().toLocaleTimeString(),message:`⚠️  未连接账号: ${disconnectedTokens.map(e=>e.name).join(", ")}`,type:"warning"}),connectedTokens.length===0?(addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${task.name} 没有可用的连接账号，取消执行 ===`,type:"error"}),!1):(task.connectedTokens=connectedTokens.map(e=>e.id),addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${task.name} 的依赖验证通过，将执行 ${connectedTokens.length} 个账号 ===`,type:"success"}),!0)},executeScheduledTask=async task=>{var t;addLog({time:new Date().toLocaleTimeString(),message:`=== 开始执行定时任务: ${task.name} ===`,type:"info"});try{const dependenciesValid=await verifyTaskDependencies(task);if(!dependenciesValid){addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务 ${task.name} 依赖验证失败，取消执行 ===`,type:"error"});return}selectedTokens.value=[...task.connectedTokens||task.selectedTokens];for(const taskName of task.selectedTasks){if(shouldStop.value)break;addLog({time:new Date().toLocaleTimeString(),message:`执行任务: ${((t=availableTasks.find(e=>e.value===taskName))==null?void 0:t.label)||taskName}`,type:"info"});const taskFunction=eval(taskName);typeof taskFunction=="function"?await taskFunction():addLog({time:new Date().toLocaleTimeString(),message:`任务函数不存在: ${taskName}`,type:"error"})}addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务执行完成: ${task.name} ===`,type:"success"})}catch(e){addLog({time:new Date().toLocaleTimeString(),message:`=== 定时任务执行失败: ${e.message} ===`,type:"error"}),console.error(`[${new Date().toISOString()}] Error executing scheduled task ${task.name}:`,e)}},boxTypeOptions=[{label:"木质宝箱",value:2001},{label:"青铜宝箱",value:2002},{label:"黄金宝箱",value:2003},{label:"铂金宝箱",value:2004}],fishTypeOptions=[{label:"普通鱼竿",value:1},{label:"黄金鱼竿",value:2}],openHelperModal=t=>{helperType.value=t,showHelperModal.value=!0},executeHelper=()=>{if(helperSettings.count%10!==0||helperSettings.count<10){message.warning("消耗数量必须是10的整数倍，最小为10");return}showHelperModal.value=!1,helperType.value==="box"?batchOpenBox():helperType.value==="fish"?batchFish():helperType.value==="recruit"&&batchRecruit()},formationOptions=[1,2,3,4,5,6].map(t=>({label:`阵容${t}`,value:t})),bossTimesOptions=[0,1,2,3,4].map(t=>({label:`${t}次`,value:t})),loadSettings=t=>{try{const e=localStorage.getItem(`daily-settings:${t}`),o={arenaFormation:1,bossFormation:1,bossTimes:2,claimBottle:!0,payRecruit:!0,openBox:!0,arenaEnable:!0,claimHangUp:!0,claimEmail:!0,blackMarketPurchase:!0};return e?{...o,...JSON.parse(e)}:o}catch(e){return console.error("Failed to load settings:",e),null}},openSettings=t=>{currentSettingsTokenId.value=t.id,currentSettingsTokenName.value=t.name;const e=loadSettings(t.id);Object.assign(currentSettings,e),showSettingsModal.value=!0},saveSettings=()=>{currentSettingsTokenId.value&&(localStorage.setItem(`daily-settings:${currentSettingsTokenId.value}`,JSON.stringify(currentSettings)),message.success(`已保存 ${currentSettingsTokenName.value} 的设置`),showSettingsModal.value=!1)},currentRunningTokenId=ref(null),currentProgress=ref(0),logs=ref([]),logContainer=ref(null),autoScrollLog=ref(!0),currentRunningTokenName=computed(()=>{const t=tokens.value.find(e=>e.id===currentRunningTokenId.value);return t?t.name:""}),isAllSelected=computed(()=>selectedTokens.value.length===tokens.value.length&&tokens.value.length>0),isIndeterminate=computed(()=>selectedTokens.value.length>0&&selectedTokens.value.length<tokens.value.length),handleSelectAll=t=>{t?selectedTokens.value=tokens.value.map(e=>e.id):selectedTokens.value=[]},getStatusType=t=>{const e=tokenStatus.value[t];return e==="completed"?"success":e==="failed"?"error":e==="running"?"info":"default"},getStatusText=t=>{const e=tokenStatus.value[t];return e==="completed"?"已完成":e==="failed"?"失败":e==="running"?"执行中":"等待中"},pickArenaTargetId=t=>{var o,s,n,a,d;const e=((o=t==null?void 0:t.rankList)==null?void 0:o[0])||((s=t==null?void 0:t.roleList)==null?void 0:s[0])||((n=t==null?void 0:t.targets)==null?void 0:n[0])||((a=t==null?void 0:t.targetList)==null?void 0:a[0])||((d=t==null?void 0:t.list)==null?void 0:d[0]);return e!=null&&e.roleId?e.roleId:e!=null&&e.id?e.id:(t==null?void 0:t.roleId)||(t==null?void 0:t.id)},getTodayStartSec=()=>{const t=new Date;return t.setHours(0,0,0,0),Math.floor(t.getTime()/1e3)},isTodayAvailable=t=>!t||typeof t!="number"?!0:t<getTodayStartSec(),calculateMonthProgress=()=>{const t=new Date,e=new Date(t.getFullYear(),t.getMonth()+1,0).getDate(),o=t.getDate();return Math.min(1,Math.max(0,o/e))},addLog=t=>{logs.value.push(t),nextTick(()=>{logContainer.value&&autoScrollLog.value&&(logContainer.value.scrollTop=logContainer.value.scrollHeight)})};watch(autoScrollLog,t=>{t&&logContainer.value&&nextTick(()=>{logContainer.value.scrollTop=logContainer.value.scrollHeight})});const copyLogs=()=>{if(logs.value.length===0){message.warning("没有可复制的日志");return}const t=logs.value.map(e=>`${e.time} ${e.message}`).join(`
`);navigator.clipboard.writeText(t).then(()=>{message.success("日志已复制到剪贴板")}).catch(e=>{message.error("复制日志失败: "+e.message)})},waitForConnection=async(t,e=2e3)=>{const o=Date.now();for(;Date.now()-o<e;){if(tokenStore.getWebSocketStatus(t)==="connected")return!0;await new Promise(n=>setTimeout(n,500))}return!1},resetBottles=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始重置罐子: ${e.name} ===`,type:"info"}),await ensureConnection(t),addLog({time:new Date().toLocaleTimeString(),message:"停止计时...",type:"info"}),await tokenStore.sendMessageWithPromise(t,"bottlehelper_stop",{},5e3),await new Promise(o=>setTimeout(o,500)),addLog({time:new Date().toLocaleTimeString(),message:"开始计时...",type:"info"}),await tokenStore.sendMessageWithPromise(t,"bottlehelper_start",{},5e3),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 重置完成 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`重置失败: ${o.message}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量重置罐子结束")}},claimHangUpRewards=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始领取挂机: ${e.name} ===`,type:"info"}),await ensureConnection(t),addLog({time:new Date().toLocaleTimeString(),message:"领取挂机奖励",type:"info"}),await tokenStore.sendMessageWithPromise(t,"system_claimhangupreward",{},5e3),await new Promise(o=>setTimeout(o,500));for(let o=0;o<4;o++)addLog({time:new Date().toLocaleTimeString(),message:`挂机加钟 ${o+1}/4`,type:"info"}),await tokenStore.sendMessageWithPromise(t,"system_mysharecallback",{isSkipShareCard:!0,type:2},5e3),await new Promise(s=>setTimeout(s,500));tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 领取完成 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`领取失败: ${o.message}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量领取挂机结束")}},batchbaoku13=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键宝库: ${e.name} ===`,type:"info"}),await ensureConnection(t);const s=(await tokenStore.sendMessageWithPromise(t,"bosstower_getinfo",{})).bossTower.towerId;if(s>=1&&s<=3){for(let n=0;n<2&&!shouldStop.value;n++)await tokenStore.sendMessageWithPromise(t,"bosstower_startboss",{}),await new Promise(a=>setTimeout(a,500));for(let n=0;n<9&&!shouldStop.value;n++)await tokenStore.sendMessageWithPromise(t,"bosstower_startbox",{}),await new Promise(a=>setTimeout(a,500))}tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 宝库战斗已完成，请上线手动领取奖励 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`宝库战斗失败: ${o.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量宝库结束")}},batchbaoku45=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键宝库: ${e.name} ===`,type:"info"}),await ensureConnection(t);const s=(await tokenStore.sendMessageWithPromise(t,"bosstower_getinfo",{})).bossTower.towerId;if(s>=4&&s<=5)for(let n=0;n<2&&!shouldStop.value;n++)await tokenStore.sendMessageWithPromise(t,"bosstower_startboss",{}),await new Promise(a=>setTimeout(a,500));tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 宝库战斗已完成 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`宝库战斗失败: ${o.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量宝库结束")}},batchmengjing=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{if(addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键宝库: ${e.name} ===`,type:"info"}),await ensureConnection(t),shouldStop.value)break;const o={0:107},s=new Date().getDay();if(s===0|s===1|s===3|s===4)await tokenStore.sendMessageWithPromise(t,"dungeon_selecthero",{battleTeam:o},5e3),await new Promise(n=>setTimeout(n,500)),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 咸王梦境已完成 ===`,type:"success"});else{addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 当前未在开放时间 ===`,type:"error"});break}}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`咸王梦境失败: ${o.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量梦境结束")}},batchlingguanzi=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{if(addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键领取盐罐: ${e.name} ===`,type:"info"}),await ensureConnection(t),shouldStop.value)break;await tokenStore.sendMessageWithPromise(t,"bottlehelper_claim",{},5e3),await new Promise(o=>setTimeout(o,500)),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 领取盐罐已完成 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`领取盐罐失败: ${o.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量领取盐罐结束")}},batchclubsign=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{if(addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键俱乐部签到: ${e.name} ===`,type:"info"}),await ensureConnection(t),shouldStop.value)break;await tokenStore.sendMessageWithPromise(t,"legion_signin",{},5e3),await new Promise(o=>setTimeout(o,500)),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 俱乐部签到已完成 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`俱乐部签到失败: ${o.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量俱乐部签到结束")}},batcharenafight=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{if(addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键竞技场战斗: ${e.name} ===`,type:"info"}),await ensureConnection(t),shouldStop.value)break;for(let o=0;o<3;o++){await tokenStore.sendMessageWithPromise(t,"arena_startarea",{});let s;try{s=await tokenStore.sendMessageWithPromise(t,"arena_getareatarget",{})}catch(a){message.error(`获取竞技场目标失败：${a.message}`);break}const n=pickArenaTargetId(s);if(!n){addLog({time:new Date().toLocaleTimeString(),message:`未找到可用的竞技场目标: ${error.message||"未知错误"}`,type:"error"});break}try{await tokenStore.sendMessageWithPromise(t,"fight_startareaarena",{targetId:n}),addLog({time:new Date().toLocaleTimeString(),message:`${e.name} 竞技场战斗 ${o+1}/3`,type:"info"}),await new Promise(a=>setTimeout(a,500))}catch{addLog({time:new Date().toLocaleTimeString(),message:`竞技场对决失败: ${error.message||"未知错误"}`,type:"error"})}}await new Promise(o=>setTimeout(o,500)),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 竞技场战斗已完成 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`竞技场战斗失败: ${o.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量竞技场战斗结束")}},batchAddHangUpTime=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键加钟: ${e.name} ===`,type:"info"}),await ensureConnection(t);for(let o=0;o<4&&!shouldStop.value;o++)addLog({time:new Date().toLocaleTimeString(),message:`执行加钟 ${o+1}/4`,type:"info"}),await tokenStore.sendMessageWithPromise(t,"system_mysharecallback",{isSkipShareCard:!0,type:2},5e3),await new Promise(s=>setTimeout(s,500));tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 加钟完成 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`加钟失败: ${o.message||"未知错误"}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量加钟结束")}},ensureConnection=async t=>{var n;const e=tokens.value.find(a=>a.id===t);let s=tokenStore.getWebSocketStatus(t)==="connected";if(!s&&(addLog({time:new Date().toLocaleTimeString(),message:"正在连接...",type:"info"}),tokenStore.createWebSocketConnection(t,e.token,e.wsUrl),s=await waitForConnection(t),!s)){addLog({time:new Date().toLocaleTimeString(),message:"连接超时，尝试重连...",type:"warning"}),tokenStore.closeWebSocketConnection(t),await new Promise(d=>setTimeout(d,2e3)),addLog({time:new Date().toLocaleTimeString(),message:"正在重连...",type:"info"});const a=tokens.value.find(d=>d.id===t);tokenStore.createWebSocketConnection(t,a.token,a.wsUrl),s=await waitForConnection(t)}if(!s)throw new Error("连接失败 (重试后仍超时)");try{await tokenStore.sendMessageWithPromise(t,"role_getroleinfo",{},5e3);const a=await tokenStore.sendMessageWithPromise(t,"fight_startlevel",{},5e3);(n=a==null?void 0:a.battleData)!=null&&n.version&&tokenStore.setBattleVersion(a.battleData.version)}catch(a){addLog({time:new Date().toLocaleTimeString(),message:`初始化数据失败: ${a.message}`,type:"warning"})}return!0},climbTower=async()=>{var t,e,o,s,n,a,d,r,c;if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(l=>{tokenStatus.value[l]="waiting"});for(const l of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=l,tokenStatus.value[l]="running",currentProgress.value=0;const p=tokens.value.find(u=>u.id===l);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始爬塔: ${p.name} ===`,type:"info"}),await ensureConnection(l),await tokenStore.sendMessageWithPromise(l,"tower_getinfo",{},5e3).catch(()=>{});let u=await tokenStore.sendGetRoleInfo(l),m=((e=(t=u==null?void 0:u.role)==null?void 0:t.tower)==null?void 0:e.energy)||0;addLog({time:new Date().toLocaleTimeString(),message:`初始体力: ${m}`,type:"info"});let g=0;const T=100;let k=0;for(;m>0&&g<T&&!shouldStop.value;)try{await tokenStore.sendMessageWithPromise(l,"fight_starttower",{},5e3),g++,k=0,addLog({time:new Date().toLocaleTimeString(),message:`爬塔第 ${g} 次`,type:"info"}),await new Promise(w=>setTimeout(w,2e3)),tokenStore.sendMessage(l,"tower_getinfo"),u=await tokenStore.sendGetRoleInfo(l);const v=(o=tokenStore.gameData)==null?void 0:o.roleInfo;m=((n=(s=v==null?void 0:v.role)==null?void 0:s.tower)==null?void 0:n.energy)??((d=(a=u==null?void 0:u.role)==null?void 0:a.tower)==null?void 0:d.energy)??0}catch(v){if(v.message&&v.message.includes("200400")){addLog({time:new Date().toLocaleTimeString(),message:"爬塔次数已用完 (200400)",type:"info"});break}if(k++,addLog({time:new Date().toLocaleTimeString(),message:`战斗出错: ${v.message} (重试 ${k}/3)`,type:"warning"}),k>=3){addLog({time:new Date().toLocaleTimeString(),message:"连续失败次数过多，停止爬塔",type:"error"});break}await new Promise(w=>setTimeout(w,2e3));try{u=await tokenStore.sendGetRoleInfo(l),m=((c=(r=u==null?void 0:u.role)==null?void 0:r.tower)==null?void 0:c.energy)||0}catch{}}tokenStatus.value[l]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${p.name} 爬塔结束，共 ${g} 次 ===`,type:"success"})}catch(u){console.error(u),tokenStatus.value[l]="failed",addLog({time:new Date().toLocaleTimeString(),message:`爬塔失败: ${u.message}`,type:"error"})}currentProgress.value=100,await new Promise(u=>setTimeout(u,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量爬塔结束")}},batchStudy=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"}),addLog({time:new Date().toLocaleTimeString(),message:"正在加载题库...",type:"info"}),await preloadQuestions();for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始答题: ${e.name} ===`,type:"info"}),await ensureConnection(t),tokenStore.gameData.studyStatus={isAnswering:!1,questionCount:0,answeredCount:0,status:"",timestamp:null},await tokenStore.sendMessageWithPromise(t,"study_startgame",{},5e3);let o=90,s=!1,n="";for(;o>0&&!shouldStop.value;){const a=tokenStore.gameData.studyStatus;if(a.status!==n&&(n=a.status,a.status==="answering"?addLog({time:new Date().toLocaleTimeString(),message:"开始答题...",type:"info"}):a.status==="claiming_rewards"&&addLog({time:new Date().toLocaleTimeString(),message:"正在领取奖励...",type:"info"})),a.status==="answering"&&a.questionCount>0,a.status==="completed"){s=!0;break}await new Promise(d=>setTimeout(d,1e3)),o--}s?(tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 答题完成 ===`,type:"success"})):shouldStop.value?addLog({time:new Date().toLocaleTimeString(),message:"已停止",type:"warning"}):(tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:"答题超时或未开始",type:"error"}))}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`答题失败: ${o.message}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量答题结束")}},batchTopUpFish=async()=>{var t,e,o,s,n,a,d,r,c;if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(l=>{tokenStatus.value[l]="waiting"});for(const l of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=l,tokenStatus.value[l]="running",currentProgress.value=0;const p=tokens.value.find(u=>u.id===l);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始钓鱼补齐: ${p.name} ===`,type:"info"}),await ensureConnection(l),addLog({time:new Date().toLocaleTimeString(),message:"获取月度任务进度...",type:"info"});const u=await tokenStore.sendMessageWithPromise(l,"activity_get",{},1e4),m=(u==null?void 0:u.activity)||((t=u==null?void 0:u.body)==null?void 0:t.activity)||u;if(!m){addLog({time:new Date().toLocaleTimeString(),message:"获取月度任务进度失败",type:"error"}),tokenStatus.value[l]="failed";continue}const g=m.myMonthInfo||{},T=Number(((e=g==null?void 0:g["2"])==null?void 0:e.num)||0),k=calculateMonthProgress(),v=new Date,w=new Date(v.getFullYear(),v.getMonth()+1,0).getDate(),f=v.getDate(),i=Math.max(0,w-f)===0?FISH_TARGET:Math.min(FISH_TARGET,Math.ceil(k*FISH_TARGET)),b=Math.max(0,i-T);if(addLog({time:new Date().toLocaleTimeString(),message:`当前进度: ${T}/${FISH_TARGET}，需要补齐: ${b}次`,type:"info"}),b<=0){addLog({time:new Date().toLocaleTimeString(),message:"当前进度已达标，无需补齐",type:"success"}),tokenStatus.value[l]="completed";continue}addLog({time:new Date().toLocaleTimeString(),message:"开始执行钓鱼补齐...",type:"info"});let y=(s=(o=tokenStore.gameData)==null?void 0:o.roleInfo)==null?void 0:s.role;if(!y)try{const D=await tokenStore.sendGetRoleInfo(l);y=D==null?void 0:D.role}catch{}let S=0;const N=Number(((n=y==null?void 0:y.statisticsTime)==null?void 0:n["artifact:normal:lottery:time"])||0);if(isTodayAvailable(N)){addLog({time:new Date().toLocaleTimeString(),message:"检测到今日免费钓鱼次数，开始消耗 3 次",type:"info"});for(let D=0;D<3&&b>S&&!shouldStop.value;D++)try{await tokenStore.sendMessageWithPromise(l,"artifact_lottery",{lotteryNumber:1,newFree:!0,type:1},8e3),S++,await new Promise(V=>setTimeout(V,500))}catch(V){addLog({time:new Date().toLocaleTimeString(),message:`免费钓鱼失败: ${V.message}`,type:"error"});break}}const h=await tokenStore.sendMessageWithPromise(l,"activity_get",{},1e4),$=((h==null?void 0:h.activity)||((a=h==null?void 0:h.body)==null?void 0:a.activity)||h).myMonthInfo||{},P=Number(((d=$==null?void 0:$["2"])==null?void 0:d.num)||0);let x=Math.max(0,i-P);if(addLog({time:new Date().toLocaleTimeString(),message:`免费次数后进度: ${P}/${FISH_TARGET}，还需补齐: ${x}次`,type:"info"}),x<=0){addLog({time:new Date().toLocaleTimeString(),message:"已通过免费次数完成目标",type:"success"}),tokenStatus.value[l]="completed";continue}for(addLog({time:new Date().toLocaleTimeString(),message:`开始付费钓鱼补齐: 共需 ${x} 次（每次最多10）`,type:"info"});x>0&&!shouldStop.value;){const D=Math.min(10,x);try{await tokenStore.sendMessageWithPromise(l,"artifact_lottery",{lotteryNumber:D,newFree:!0,type:1},12e3),addLog({time:new Date().toLocaleTimeString(),message:`完成 ${D} 次付费钓鱼`,type:"info"}),x-=D,await new Promise(V=>setTimeout(V,800))}catch(V){addLog({time:new Date().toLocaleTimeString(),message:`付费钓鱼失败: ${V.message}`,type:"error"});break}}const _=await tokenStore.sendMessageWithPromise(l,"activity_get",{},1e4),C=((_==null?void 0:_.activity)||((r=_==null?void 0:_.body)==null?void 0:r.activity)||_).myMonthInfo||{},R=Number(((c=C==null?void 0:C["2"])==null?void 0:c.num)||0);R>=i||R>=FISH_TARGET?addLog({time:new Date().toLocaleTimeString(),message:`钓鱼补齐完成，最终进度: ${R}/${FISH_TARGET}`,type:"success"}):addLog({time:new Date().toLocaleTimeString(),message:`钓鱼补齐已停止，未达到目标，最终进度: ${R}/${FISH_TARGET}`,type:"warning"}),tokenStatus.value[l]="completed"}catch(u){console.error(u),tokenStatus.value[l]="failed",addLog({time:new Date().toLocaleTimeString(),message:`钓鱼补齐失败: ${u.message}`,type:"error"})}currentProgress.value=100,await new Promise(u=>setTimeout(u,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量钓鱼补齐结束")}},batchTopUpArena=async()=>{var t,e,o;if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(s=>{tokenStatus.value[s]="waiting"});for(const s of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=s,tokenStatus.value[s]="running",currentProgress.value=0;const n=tokens.value.find(a=>a.id===s);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始竞技场补齐: ${n.name} ===`,type:"info"}),await ensureConnection(s),addLog({time:new Date().toLocaleTimeString(),message:"获取月度任务进度...",type:"info"});const a=await tokenStore.sendMessageWithPromise(s,"activity_get",{},1e4),d=(a==null?void 0:a.activity)||((t=a==null?void 0:a.body)==null?void 0:t.activity)||a;if(!d){addLog({time:new Date().toLocaleTimeString(),message:"获取月度任务进度失败",type:"error"}),tokenStatus.value[s]="failed";continue}const r=d.myArenaInfo||{},c=Number((r==null?void 0:r.num)||0),l=calculateMonthProgress(),p=new Date,u=new Date(p.getFullYear(),p.getMonth()+1,0).getDate(),m=p.getDate(),T=Math.max(0,u-m)===0?ARENA_TARGET:Math.min(ARENA_TARGET,Math.ceil(l*ARENA_TARGET)),k=Math.max(0,T-c);if(addLog({time:new Date().toLocaleTimeString(),message:`当前进度: ${c}/${ARENA_TARGET}，需要补齐: ${k}次`,type:"info"}),k<=0){addLog({time:new Date().toLocaleTimeString(),message:"当前进度已达标，无需补齐",type:"success"}),tokenStatus.value[s]="completed";continue}addLog({time:new Date().toLocaleTimeString(),message:"开始执行竞技场补齐...",type:"info"});try{await tokenStore.sendMessageWithPromise(s,"arena_startarea",{},6e3)}catch(N){addLog({time:new Date().toLocaleTimeString(),message:`开始竞技场失败: ${N.message}`,type:"warning"})}let v=0;const w=100;let f=1,L=k;for(;L>0&&v<w&&!shouldStop.value;){const N=Math.ceil(L/2);addLog({time:new Date().toLocaleTimeString(),message:`第${f}轮：计划战斗 ${N} 场`,type:"info"});for(let x=0;x<N&&v<w&&!shouldStop.value;x++){let _;try{_=await tokenStore.sendMessageWithPromise(s,"arena_getareatarget",{},8e3)}catch(C){addLog({time:new Date().toLocaleTimeString(),message:`获取竞技场目标失败：${C.message}`,type:"error"});break}const M=pickArenaTargetId(_);if(!M){addLog({time:new Date().toLocaleTimeString(),message:"未找到可用的竞技场目标",type:"warning"});break}try{await tokenStore.sendMessageWithPromise(s,"fight_startareaarena",{targetId:M},15e3),addLog({time:new Date().toLocaleTimeString(),message:`竞技场战斗 ${x+1}/${N} 完成`,type:"info"})}catch(C){addLog({time:new Date().toLocaleTimeString(),message:`竞技场对决失败：${C.message}`,type:"error"})}v++,await new Promise(C=>setTimeout(C,1200))}const h=await tokenStore.sendMessageWithPromise(s,"activity_get",{},1e4),$=((h==null?void 0:h.activity)||((e=h==null?void 0:h.body)==null?void 0:e.activity)||h).myArenaInfo||{},P=Number(($==null?void 0:$.num)||0);L=Math.max(0,T-P),addLog({time:new Date().toLocaleTimeString(),message:`第${f}轮后进度: ${P}/${ARENA_TARGET}，还需补齐: ${L}次`,type:"info"}),f++}const i=await tokenStore.sendMessageWithPromise(s,"activity_get",{},1e4),y=((i==null?void 0:i.activity)||((o=i==null?void 0:i.body)==null?void 0:o.activity)||i).myArenaInfo||{},S=Number((y==null?void 0:y.num)||0);S>=T||S>=ARENA_TARGET?addLog({time:new Date().toLocaleTimeString(),message:`竞技场补齐完成，最终进度: ${S}/${ARENA_TARGET}`,type:"success"}):v>=w?addLog({time:new Date().toLocaleTimeString(),message:`达到安全上限，竞技场补齐已停止，最终进度: ${S}/${ARENA_TARGET}`,type:"warning"}):addLog({time:new Date().toLocaleTimeString(),message:`竞技场补齐已停止，未达到目标，最终进度: ${S}/${ARENA_TARGET}`,type:"warning"}),tokenStatus.value[s]="completed"}catch(a){console.error(a),tokenStatus.value[s]="failed",addLog({time:new Date().toLocaleTimeString(),message:`竞技场补齐失败: ${a.message}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量竞技场补齐结束")}},normalizeCars=t=>{const e=t||{},o=e.body||e,s=o.roleCar||o.rolecar||{},n=s.carDataMap||s.cardatamap;if(n&&typeof n=="object")return Object.entries(n).map(([d,r],c)=>({key:c,id:d,...r||{}}));let a=o.cars||o.list||o.data||o.carList||o.vehicles||[];return!Array.isArray(a)&&typeof a=="object"&&a!==null&&(a=Object.values(a)),Array.isArray(o)&&a.length===0&&(a=o),(Array.isArray(a)?a:[]).map((d,r)=>({key:r,...d}))},gradeLabel=t=>({1:"绿·普通",2:"蓝·稀有",3:"紫·史诗",4:"橙·传说",5:"红·神话",6:"金·传奇"})[t]||"未知",isBigPrize=t=>{const e=[{type:3,itemId:3201,value:10},{type:3,itemId:1001,value:10},{type:3,itemId:1022,value:2e3},{type:2,itemId:0,value:2e3},{type:3,itemId:1023,value:5},{type:3,itemId:1022,value:2500},{type:3,itemId:1001,value:12}];return Array.isArray(t)?e.some(o=>t.find(s=>s.type===o.type&&s.itemId===o.itemId&&Number(s.value||0)>=o.value)):!1},countRacingRefreshTickets=t=>Array.isArray(t)?t.reduce((e,o)=>e+(o.type===3&&o.itemId===35002?Number(o.value||0):0),0):0,shouldSendCar=(t,e)=>{const o=Number((t==null?void 0:t.color)||0),s=Array.isArray(t==null?void 0:t.rewards)?t.rewards:[],n=countRacingRefreshTickets(s);return e>=6?o>=5||n>=4||isBigPrize(s):o>=4||n>=2||isBigPrize(s)},canClaim=t=>{const e=Number((t==null?void 0:t.sendAt)||0);if(!e)return!1;const o=e<1e12?e*1e3:e;return Date.now()-o>=FOUR_HOURS_MS},batchSmartSendCar=async()=>{var t,e,o,s,n,a,d;if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(r=>{tokenStatus.value[r]="waiting"});for(const r of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=r,tokenStatus.value[r]="running",currentProgress.value=0;const c=tokens.value.find(l=>l.id===r);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始智能发车: ${c.name} ===`,type:"info"}),await ensureConnection(r),addLog({time:new Date().toLocaleTimeString(),message:"获取车辆信息...",type:"info"});const l=await tokenStore.sendMessageWithPromise(r,"car_getrolecar",{},1e4);let p=normalizeCars((l==null?void 0:l.body)??l),u=0;try{const m=await tokenStore.sendMessageWithPromise(r,"role_getroleinfo",{},1e4),g=(o=(e=(t=m==null?void 0:m.role)==null?void 0:t.items)==null?void 0:e[35002])==null?void 0:o.quantity;u=Number(g||0),addLog({time:new Date().toLocaleTimeString(),message:`剩余车票: ${u}`,type:"info"})}catch{}for(const m of p){if(shouldStop.value)break;if(Number(m.sendAt||0)!==0)continue;if(shouldSendCar(m,u)){addLog({time:new Date().toLocaleTimeString(),message:`车辆[${gradeLabel(m.color)}]满足条件，直接发车`,type:"info"}),await tokenStore.sendMessageWithPromise(r,"car_send",{carId:String(m.id),helperId:0,text:"",isUpgrade:!1},1e4),await new Promise(k=>setTimeout(k,500));continue}let g=!1;const T=Number(m.refreshCount??0)===0;if(u>=6)g=!0;else if(T)g=!0;else{addLog({time:new Date().toLocaleTimeString(),message:`车辆[${gradeLabel(m.color)}]不满足条件且无刷新次数，直接发车`,type:"warning"}),await tokenStore.sendMessageWithPromise(r,"car_send",{carId:String(m.id),helperId:0,text:"",isUpgrade:!1},1e4),await new Promise(k=>setTimeout(k,500));continue}for(;g&&!shouldStop.value;){addLog({time:new Date().toLocaleTimeString(),message:`车辆[${gradeLabel(m.color)}]尝试刷新...`,type:"info"});const k=await tokenStore.sendMessageWithPromise(r,"car_refresh",{carId:String(m.id)},1e4),v=(k==null?void 0:k.car)||((s=k==null?void 0:k.body)==null?void 0:s.car)||k;v&&typeof v=="object"&&(v.color!=null&&(m.color=Number(v.color)),v.refreshCount!=null&&(m.refreshCount=Number(v.refreshCount)),v.rewards!=null&&(m.rewards=v.rewards));try{const f=await tokenStore.sendMessageWithPromise(r,"role_getroleinfo",{},5e3);u=Number(((d=(a=(n=f==null?void 0:f.role)==null?void 0:n.items)==null?void 0:a[35002])==null?void 0:d.quantity)||0)}catch{}if(shouldSendCar(m,u)){addLog({time:new Date().toLocaleTimeString(),message:`刷新后车辆[${gradeLabel(m.color)}]满足条件，发车`,type:"success"}),await tokenStore.sendMessageWithPromise(r,"car_send",{carId:String(m.id),helperId:0,text:"",isUpgrade:!1},1e4),await new Promise(f=>setTimeout(f,500));break}const w=Number(m.refreshCount??0)===0;if(u>=6)g=!0;else if(w)g=!0;else{addLog({time:new Date().toLocaleTimeString(),message:`刷新后车辆[${gradeLabel(m.color)}]仍不满足条件且无刷新次数，发车`,type:"warning"}),await tokenStore.sendMessageWithPromise(r,"car_send",{carId:String(m.id),helperId:0,text:"",isUpgrade:!1},1e4),await new Promise(f=>setTimeout(f,500));break}await new Promise(f=>setTimeout(f,1e3))}}tokenStatus.value[r]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${c.name} 智能发车完成 ===`,type:"success"})}catch(l){console.error(l),tokenStatus.value[r]="failed",addLog({time:new Date().toLocaleTimeString(),message:`智能发车失败: ${l.message}`,type:"error"})}currentProgress.value=100,await new Promise(l=>setTimeout(l,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量智能发车结束")}},batchClaimCars=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始一键收车: ${e.name} ===`,type:"info"}),await ensureConnection(t),addLog({time:new Date().toLocaleTimeString(),message:"获取车辆信息...",type:"info"});const o=await tokenStore.sendMessageWithPromise(t,"car_getrolecar",{},1e4);let s=normalizeCars((o==null?void 0:o.body)??o),n=0;for(const a of s)if(canClaim(a)){try{await tokenStore.sendMessageWithPromise(t,"car_claim",{carId:String(a.id)},1e4),n++,addLog({time:new Date().toLocaleTimeString(),message:`收车成功: ${gradeLabel(a.color)}`,type:"success"})}catch(d){addLog({time:new Date().toLocaleTimeString(),message:`收车失败: ${d.message}`,type:"warning"})}await new Promise(d=>setTimeout(d,300))}n===0&&addLog({time:new Date().toLocaleTimeString(),message:"没有可收取的车辆",type:"info"}),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 收车完成，共收取 ${n} 辆 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`收车失败: ${o.message}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量一键收车结束")}},startBatch=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;let e=0;const o=1;let s=!1;for(;e<=o&&!s;){const n=tokens.value.find(a=>a.id===t);try{addLog(e===0?{time:new Date().toLocaleTimeString(),message:`=== 开始执行: ${n.name} ===`,type:"info"}:{time:new Date().toLocaleTimeString(),message:`=== 尝试重试: ${n.name} (第${e}次) ===`,type:"info"}),await ensureConnection(t),await runner.run(t,{onLog:a=>addLog(a),onProgress:a=>{currentProgress.value=a}}),s=!0,tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${n.name} 执行完成 ===`,type:"success"})}catch(a){console.error(a),e<o?(addLog({time:new Date().toLocaleTimeString(),message:`执行出错: ${a.message}，等待3秒后重试...`,type:"warning"}),await new Promise(d=>setTimeout(d,3e3)),e++):(tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`执行失败: ${a.message}`,type:"error"}))}}await new Promise(n=>setTimeout(n,1e3))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量任务执行结束")}},batchClaimBoxPointReward=async()=>{if(selectedTokens.value.length!==0){isRunning.value=!0,shouldStop.value=!1,selectedTokens.value.forEach(t=>{tokenStatus.value[t]="waiting"});for(const t of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=t,tokenStatus.value[t]="running",currentProgress.value=0;const e=tokens.value.find(o=>o.id===t);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始领取宝箱积分: ${e.name} ===`,type:"info"}),await ensureConnection(t),await tokenStore.sendMessageWithPromise(t,"item_batchclaimboxpointreward",{},5e3),addLog({time:new Date().toLocaleTimeString(),message:"宝箱积分领取成功",type:"success"}),await tokenStore.sendMessage(t,"role_getroleinfo"),tokenStatus.value[t]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${e.name} 领取完成 ===`,type:"success"})}catch(o){console.error(o),tokenStatus.value[t]="failed",addLog({time:new Date().toLocaleTimeString(),message:`领取失败: ${o.message}`,type:"error"})}currentProgress.value=100,await new Promise(o=>setTimeout(o,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量领取宝箱积分结束")}},batchOpenBox=async()=>{if(selectedTokens.value.length===0)return;isRunning.value=!0,shouldStop.value=!1;const t=helperSettings.boxType,e=helperSettings.count,o=Math.floor(e/10),s=e%10,n={2001:"木质宝箱",2002:"青铜宝箱",2003:"黄金宝箱",2004:"铂金宝箱"};selectedTokens.value.forEach(a=>{tokenStatus.value[a]="waiting"});for(const a of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=a,tokenStatus.value[a]="running",currentProgress.value=0;const d=tokens.value.find(r=>r.id===a);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始批量开箱: ${d.name} ===`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`宝箱类型: ${n[t]}, 数量: ${e}`,type:"info"}),await ensureConnection(a);for(let r=0;r<o&&!shouldStop.value;r++)await tokenStore.sendMessageWithPromise(a,"item_openbox",{itemId:t,number:10},5e3),currentProgress.value=Math.floor((r+1)/(o+(s>0?1:0))*100),addLog({time:new Date().toLocaleTimeString(),message:`开箱进度: ${(r+1)*10}/${e}`,type:"info"}),await new Promise(c=>setTimeout(c,300));s>0&&!shouldStop.value&&(await tokenStore.sendMessageWithPromise(a,"item_openbox",{itemId:t,number:s},5e3),addLog({time:new Date().toLocaleTimeString(),message:`开箱进度: ${e}/${e}`,type:"info"})),await tokenStore.sendMessageWithPromise(a,"item_batchclaimboxpointreward"),await new Promise(r=>setTimeout(r,500)),await tokenStore.sendMessage(a,"role_getroleinfo"),tokenStatus.value[a]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${d.name} 开箱完成 ===`,type:"success"})}catch(r){console.error(r),tokenStatus.value[a]="failed",addLog({time:new Date().toLocaleTimeString(),message:`开箱失败: ${r.message}`,type:"error"})}currentProgress.value=100,await new Promise(r=>setTimeout(r,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量开箱结束")},batchFish=async()=>{if(selectedTokens.value.length===0)return;isRunning.value=!0,shouldStop.value=!1;const t=helperSettings.fishType,e=helperSettings.count,o=Math.floor(e/10),s=e%10,n={1:"普通鱼竿",2:"黄金鱼竿"};selectedTokens.value.forEach(a=>{tokenStatus.value[a]="waiting"});for(const a of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=a,tokenStatus.value[a]="running",currentProgress.value=0;const d=tokens.value.find(r=>r.id===a);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始批量钓鱼: ${d.name} ===`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`鱼竿类型: ${n[t]}, 数量: ${e}`,type:"info"}),await ensureConnection(a);for(let r=0;r<o&&!shouldStop.value;r++)await tokenStore.sendMessageWithPromise(a,"artifact_lottery",{type:t,lotteryNumber:10,newFree:!0},5e3),currentProgress.value=Math.floor((r+1)/(o+(s>0?1:0))*100),addLog({time:new Date().toLocaleTimeString(),message:`钓鱼进度: ${(r+1)*10}/${e}`,type:"info"}),await new Promise(c=>setTimeout(c,300));s>0&&!shouldStop.value&&(await tokenStore.sendMessageWithPromise(a,"artifact_lottery",{type:t,lotteryNumber:s,newFree:!0},5e3),addLog({time:new Date().toLocaleTimeString(),message:`钓鱼进度: ${e}/${e}`,type:"info"})),await tokenStore.sendMessage(a,"role_getroleinfo"),tokenStatus.value[a]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${d.name} 钓鱼完成 ===`,type:"success"})}catch(r){console.error(r),tokenStatus.value[a]="failed",addLog({time:new Date().toLocaleTimeString(),message:`钓鱼失败: ${r.message}`,type:"error"})}currentProgress.value=100,await new Promise(r=>setTimeout(r,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量钓鱼结束")},batchRecruit=async()=>{if(selectedTokens.value.length===0)return;isRunning.value=!0,shouldStop.value=!1;const t=helperSettings.count,e=Math.floor(t/10),o=t%10;selectedTokens.value.forEach(s=>{tokenStatus.value[s]="waiting"});for(const s of selectedTokens.value){if(shouldStop.value)break;currentRunningTokenId.value=s,tokenStatus.value[s]="running",currentProgress.value=0;const n=tokens.value.find(a=>a.id===s);try{addLog({time:new Date().toLocaleTimeString(),message:`=== 开始批量招募: ${n.name} ===`,type:"info"}),addLog({time:new Date().toLocaleTimeString(),message:`招募数量: ${t}`,type:"info"}),await ensureConnection(s);for(let a=0;a<e&&!shouldStop.value;a++)await tokenStore.sendMessageWithPromise(s,"hero_recruit",{recruitType:1,recruitNumber:10},5e3),currentProgress.value=Math.floor((a+1)/(e+(o>0?1:0))*100),addLog({time:new Date().toLocaleTimeString(),message:`招募进度: ${(a+1)*10}/${t}`,type:"info"}),await new Promise(d=>setTimeout(d,300));o>0&&!shouldStop.value&&(await tokenStore.sendMessageWithPromise(s,"hero_recruit",{recruitType:1,recruitNumber:o},5e3),addLog({time:new Date().toLocaleTimeString(),message:`招募进度: ${t}/${t}`,type:"info"})),await tokenStore.sendMessage(s,"role_getroleinfo"),tokenStatus.value[s]="completed",addLog({time:new Date().toLocaleTimeString(),message:`=== ${n.name} 招募完成 ===`,type:"success"})}catch(a){console.error(a),tokenStatus.value[s]="failed",addLog({time:new Date().toLocaleTimeString(),message:`招募失败: ${a.message}`,type:"error"})}currentProgress.value=100,await new Promise(a=>setTimeout(a,500))}isRunning.value=!1,currentRunningTokenId.value=null,message.success("批量招募结束")},stopBatch=()=>{shouldStop.value=!0,addLog({time:new Date().toLocaleTimeString(),message:"正在停止...",type:"warning"})};return(t,e)=>{const o=resolveComponent("n-button"),s=resolveComponent("n-space"),n=resolveComponent("n-checkbox"),a=resolveComponent("n-tag"),d=resolveComponent("n-icon"),r=resolveComponent("n-grid-item"),c=resolveComponent("n-grid"),l=resolveComponent("n-checkbox-group"),p=resolveComponent("n-card"),u=resolveComponent("n-progress"),m=resolveComponent("n-select"),g=resolveComponent("n-switch"),T=resolveComponent("n-modal"),k=resolveComponent("n-input-number"),v=resolveComponent("n-input"),w=resolveComponent("n-radio"),f=resolveComponent("n-radio-group"),L=resolveComponent("n-time-picker");return openBlock(),createElementBlock("div",_hoisted_1,[createBaseVNode("div",_hoisted_2,[createBaseVNode("div",_hoisted_3,[createBaseVNode("div",_hoisted_4,[e[32]||(e[32]=createBaseVNode("h2",null,"批量日常任务",-1)),createBaseVNode("div",_hoisted_5,[createVNode(o,{type:"primary",onClick:startBatch,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[createTextVNode(toDisplayString(isRunning.value?"执行中...":"开始执行"),1)]),_:1},8,["disabled"]),createVNode(o,{onClick:stopBatch,disabled:!isRunning.value,type:"error",style:{"margin-left":"12px"}},{default:withCtx(()=>[...e[31]||(e[31]=[createTextVNode(" 停止 ",-1)])]),_:1},8,["disabled"])])]),createVNode(p,{title:"账号列表",class:"token-list-card"},{default:withCtx(()=>[createVNode(s,{style:{"margin-bottom":"12px"}},{default:withCtx(()=>[createVNode(o,{size:"small",onClick:claimHangUpRewards,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[33]||(e[33]=[createTextVNode(" 领取挂机 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchAddHangUpTime,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[34]||(e[34]=[createTextVNode(" 一键加钟 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:resetBottles,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[35]||(e[35]=[createTextVNode(" 重置罐子 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchlingguanzi,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[36]||(e[36]=[createTextVNode(" 一键领取罐子 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:climbTower,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[37]||(e[37]=[createTextVNode(" 一键爬塔 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchStudy,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[38]||(e[38]=[createTextVNode(" 一键答题 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchSmartSendCar,disabled:isRunning.value||selectedTokens.value.length===0||!isCarActivityOpen.value},{default:withCtx(()=>[...e[39]||(e[39]=[createTextVNode(" 智能发车 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchClaimCars,disabled:isRunning.value||selectedTokens.value.length===0||!isCarActivityOpen.value},{default:withCtx(()=>[...e[40]||(e[40]=[createTextVNode(" 一键收车 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:e[0]||(e[0]=i=>openHelperModal("box")),disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[41]||(e[41]=[createTextVNode(" 批量开箱 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchClaimBoxPointReward,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[42]||(e[42]=[createTextVNode(" 领取宝箱积分 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:e[1]||(e[1]=i=>openHelperModal("fish")),disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[43]||(e[43]=[createTextVNode(" 批量钓鱼 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:e[2]||(e[2]=i=>openHelperModal("recruit")),disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[44]||(e[44]=[createTextVNode(" 批量招募 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchbaoku13,disabled:isRunning.value||selectedTokens.value.length===0||!isbaokuActivityOpen.value},{default:withCtx(()=>[...e[45]||(e[45]=[createTextVNode(" 一键宝库前3层 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchbaoku45,disabled:isRunning.value||selectedTokens.value.length===0||!isbaokuActivityOpen.value},{default:withCtx(()=>[...e[46]||(e[46]=[createTextVNode(" 一键宝库4,5层 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchmengjing,disabled:isRunning.value||selectedTokens.value.length===0||!ismengjingActivityOpen.value},{default:withCtx(()=>[...e[47]||(e[47]=[createTextVNode(" 一键梦境 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchclubsign,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[48]||(e[48]=[createTextVNode(" 一键俱乐部签到 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batcharenafight,disabled:isRunning.value||selectedTokens.value.length===0||!isarenaActivityOpen.value},{default:withCtx(()=>[...e[49]||(e[49]=[createTextVNode(" 一键竞技场战斗3次 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchTopUpFish,disabled:isRunning.value||selectedTokens.value.length===0},{default:withCtx(()=>[...e[50]||(e[50]=[createTextVNode(" 一键钓鱼补齐 ",-1)])]),_:1},8,["disabled"]),createVNode(o,{size:"small",onClick:batchTopUpArena,disabled:isRunning.value||selectedTokens.value.length===0||!isarenaActivityOpen.value},{default:withCtx(()=>[...e[51]||(e[51]=[createTextVNode(" 一键竞技场补齐 ",-1)])]),_:1},8,["disabled"])]),_:1}),createVNode(s,{vertical:""},{default:withCtx(()=>[createVNode(n,{checked:isAllSelected.value,indeterminate:isIndeterminate.value,"onUpdate:checked":handleSelectAll},{default:withCtx(()=>[...e[52]||(e[52]=[createTextVNode(" 全选 ",-1)])]),_:1},8,["checked","indeterminate"]),createVNode(l,{value:selectedTokens.value,"onUpdate:value":e[3]||(e[3]=i=>selectedTokens.value=i)},{default:withCtx(()=>[createVNode(c,{"x-gap":12,"y-gap":8,cols:2},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(tokens.value,i=>(openBlock(),createBlock(r,{key:i.id},{default:withCtx(()=>[createBaseVNode("div",_hoisted_6,[createVNode(n,{value:i.id,label:i.name,style:{flex:"1"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_7,[createBaseVNode("span",null,toDisplayString(i.name),1),createVNode(a,{size:"small",type:getStatusType(i.id),style:{"margin-left":"8px"}},{default:withCtx(()=>[createTextVNode(toDisplayString(getStatusText(i.id)),1)]),_:2},1032,["type"])])]),_:2},1032,["value","label"]),createVNode(o,{size:"tiny",circle:"",onClick:withModifiers(b=>openSettings(i),["stop"])},{icon:withCtx(()=>[createVNode(d,null,{default:withCtx(()=>[createVNode(unref(Settings))]),_:1})]),_:1},8,["onClick"])])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),_:1})]),_:1}),createVNode(p,{title:"定时任务",class:"scheduled-tasks-card",style:{"margin-top":"16px"}},{default:withCtx(()=>[createVNode(s,{style:{"margin-bottom":"12px"}},{default:withCtx(()=>[createVNode(o,{type:"primary",size:"small",onClick:openTaskModal},{default:withCtx(()=>[...e[53]||(e[53]=[createTextVNode(" 新增定时任务 ",-1)])]),_:1}),createVNode(o,{size:"small",onClick:e[4]||(e[4]=i=>showTasksModal.value=!0)},{default:withCtx(()=>[...e[54]||(e[54]=[createTextVNode(" 查看定时任务 ",-1)])]),_:1})]),_:1}),createBaseVNode("div",_hoisted_8,[e[55]||(e[55]=createBaseVNode("h4",{style:{margin:"0 0 12px 0",color:"#333"}},"即将执行的任务",-1)),shortestCountdownTask.value?(openBlock(),createElementBlock("div",_hoisted_9,[createBaseVNode("div",_hoisted_10,toDisplayString(shortestCountdownTask.value.task.name),1),createBaseVNode("div",{style:normalizeStyle([{"font-size":"24px","font-weight":"bold",color:"#1677ff"},{color:shortestCountdownTask.value.countdown.isNearExecution?"#ff4d4f":"#1677ff"}])},toDisplayString(shortestCountdownTask.value.countdown.formatted),5)])):(openBlock(),createElementBlock("div",_hoisted_11," 暂无定时任务 "))]),scheduledTasks.value.length>0?(openBlock(),createElementBlock("div",_hoisted_12,[createBaseVNode("p",null,"已保存 "+toDisplayString(scheduledTasks.value.length)+" 个定时任务",1)])):(openBlock(),createElementBlock("div",_hoisted_13,[...e[56]||(e[56]=[createBaseVNode("p",null,"暂无定时任务",-1)])]))]),_:1})]),createBaseVNode("div",_hoisted_14,[createVNode(p,{title:currentRunningTokenName.value?`正在执行: ${currentRunningTokenName.value}`:"执行日志",class:"log-card"},{"header-extra":withCtx(()=>[createBaseVNode("div",_hoisted_15,[createVNode(n,{checked:autoScrollLog.value,"onUpdate:checked":e[5]||(e[5]=i=>autoScrollLog.value=i),size:"small"},{default:withCtx(()=>[...e[57]||(e[57]=[createTextVNode(" 自动滚动 ",-1)])]),_:1},8,["checked"]),createVNode(o,{size:"small",onClick:copyLogs,style:{"margin-left":"8px"}},{default:withCtx(()=>[...e[58]||(e[58]=[createTextVNode(" 复制日志 ",-1)])]),_:1})])]),default:withCtx(()=>[createVNode(u,{type:"line",percentage:currentProgress.value,"indicator-placement":"inside",processing:""},null,8,["percentage"]),createBaseVNode("div",{class:"log-container",ref_key:"logContainer",ref:logContainer},[(openBlock(!0),createElementBlock(Fragment,null,renderList(logs.value,(i,b)=>(openBlock(),createElementBlock("div",{key:b,class:normalizeClass(["log-item",i.type])},[createBaseVNode("span",_hoisted_16,toDisplayString(i.time),1),createBaseVNode("span",_hoisted_17,toDisplayString(i.message),1)],2))),128))],512)]),_:1},8,["title"])])]),createVNode(T,{show:showSettingsModal.value,"onUpdate:show":e[16]||(e[16]=i=>showSettingsModal.value=i),preset:"card",title:`任务设置 - ${currentSettingsTokenName.value}`,style:{width:"90%","max-width":"400px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_18,[createBaseVNode("div",_hoisted_19,[createBaseVNode("div",_hoisted_20,[e[59]||(e[59]=createBaseVNode("label",{class:"setting-label"},"竞技场阵容",-1)),createVNode(m,{value:currentSettings.arenaFormation,"onUpdate:value":e[6]||(e[6]=i=>currentSettings.arenaFormation=i),options:unref(formationOptions),size:"small"},null,8,["value","options"])]),createBaseVNode("div",_hoisted_21,[e[60]||(e[60]=createBaseVNode("label",{class:"setting-label"},"BOSS阵容",-1)),createVNode(m,{value:currentSettings.bossFormation,"onUpdate:value":e[7]||(e[7]=i=>currentSettings.bossFormation=i),options:unref(formationOptions),size:"small"},null,8,["value","options"])]),createBaseVNode("div",_hoisted_22,[e[61]||(e[61]=createBaseVNode("label",{class:"setting-label"},"BOSS次数",-1)),createVNode(m,{value:currentSettings.bossTimes,"onUpdate:value":e[8]||(e[8]=i=>currentSettings.bossTimes=i),options:unref(bossTimesOptions),size:"small"},null,8,["value","options"])]),createBaseVNode("div",_hoisted_23,[createBaseVNode("div",_hoisted_24,[e[62]||(e[62]=createBaseVNode("span",{class:"switch-label"},"领罐子",-1)),createVNode(g,{value:currentSettings.claimBottle,"onUpdate:value":e[9]||(e[9]=i=>currentSettings.claimBottle=i)},null,8,["value"])]),createBaseVNode("div",_hoisted_25,[e[63]||(e[63]=createBaseVNode("span",{class:"switch-label"},"领挂机",-1)),createVNode(g,{value:currentSettings.claimHangUp,"onUpdate:value":e[10]||(e[10]=i=>currentSettings.claimHangUp=i)},null,8,["value"])]),createBaseVNode("div",_hoisted_26,[e[64]||(e[64]=createBaseVNode("span",{class:"switch-label"},"竞技场",-1)),createVNode(g,{value:currentSettings.arenaEnable,"onUpdate:value":e[11]||(e[11]=i=>currentSettings.arenaEnable=i)},null,8,["value"])]),createBaseVNode("div",_hoisted_27,[e[65]||(e[65]=createBaseVNode("span",{class:"switch-label"},"开宝箱",-1)),createVNode(g,{value:currentSettings.openBox,"onUpdate:value":e[12]||(e[12]=i=>currentSettings.openBox=i)},null,8,["value"])]),createBaseVNode("div",_hoisted_28,[e[66]||(e[66]=createBaseVNode("span",{class:"switch-label"},"领取邮件奖励",-1)),createVNode(g,{value:currentSettings.claimEmail,"onUpdate:value":e[13]||(e[13]=i=>currentSettings.claimEmail=i)},null,8,["value"])]),createBaseVNode("div",_hoisted_29,[e[67]||(e[67]=createBaseVNode("span",{class:"switch-label"},"黑市购买物品",-1)),createVNode(g,{value:currentSettings.blackMarketPurchase,"onUpdate:value":e[14]||(e[14]=i=>currentSettings.blackMarketPurchase=i)},null,8,["value"])]),createBaseVNode("div",_hoisted_30,[e[68]||(e[68]=createBaseVNode("span",{class:"switch-label"},"付费招募",-1)),createVNode(g,{value:currentSettings.payRecruit,"onUpdate:value":e[15]||(e[15]=i=>currentSettings.payRecruit=i)},null,8,["value"])])])]),createBaseVNode("div",_hoisted_31,[createVNode(o,{type:"primary",onClick:saveSettings},{default:withCtx(()=>[...e[69]||(e[69]=[createTextVNode("保存设置",-1)])]),_:1})])])]),_:1},8,["show","title"]),createVNode(T,{show:showHelperModal.value,"onUpdate:show":e[21]||(e[21]=i=>showHelperModal.value=i),preset:"card",title:helperModalTitle.value,style:{width:"90%","max-width":"400px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_32,[createBaseVNode("div",_hoisted_33,[helperType.value==="box"?(openBlock(),createElementBlock("div",_hoisted_34,[e[70]||(e[70]=createBaseVNode("label",{class:"setting-label"},"宝箱类型",-1)),createVNode(m,{value:helperSettings.boxType,"onUpdate:value":e[17]||(e[17]=i=>helperSettings.boxType=i),options:boxTypeOptions,size:"small"},null,8,["value"])])):createCommentVNode("",!0),helperType.value==="fish"?(openBlock(),createElementBlock("div",_hoisted_35,[e[71]||(e[71]=createBaseVNode("label",{class:"setting-label"},"鱼竿类型",-1)),createVNode(m,{value:helperSettings.fishType,"onUpdate:value":e[18]||(e[18]=i=>helperSettings.fishType=i),options:fishTypeOptions,size:"small"},null,8,["value"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_36,[e[72]||(e[72]=createBaseVNode("label",{class:"setting-label"},"消耗数量（10的倍数）",-1)),createVNode(k,{value:helperSettings.count,"onUpdate:value":e[19]||(e[19]=i=>helperSettings.count=i),min:10,max:1e4,step:10,size:"small"},null,8,["value"])])]),createBaseVNode("div",_hoisted_37,[createVNode(o,{onClick:e[20]||(e[20]=i=>showHelperModal.value=!1),style:{"margin-right":"12px"}},{default:withCtx(()=>[...e[73]||(e[73]=[createTextVNode("取消",-1)])]),_:1}),createVNode(o,{type:"primary",onClick:executeHelper},{default:withCtx(()=>[...e[74]||(e[74]=[createTextVNode("开始执行",-1)])]),_:1})])])]),_:1},8,["show","title"]),createVNode(T,{show:showTasksModal.value,"onUpdate:show":e[22]||(e[22]=i=>showTasksModal.value=i),preset:"card",title:"定时任务列表",style:{width:"90%","max-width":"800px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_38,[(openBlock(!0),createElementBlock(Fragment,null,renderList(scheduledTasks.value,i=>{var b,y;return openBlock(),createElementBlock("div",{key:i.id,class:"task-item",style:{"margin-bottom":"16px",padding:"12px",border:"1px solid #e5e7eb","border-radius":"8px"}},[createBaseVNode("div",_hoisted_39,[createBaseVNode("div",_hoisted_40,toDisplayString(i.name),1),createVNode(g,{value:i.enabled,"onUpdate:value":[S=>i.enabled=S,S=>toggleTaskEnabled(i.id,S)]},null,8,["value","onUpdate:value"])]),createBaseVNode("div",_hoisted_41,[e[75]||(e[75]=createBaseVNode("span",{style:{color:"#6b7280"}},"运行类型：",-1)),createBaseVNode("span",null,toDisplayString(i.runType==="daily"?"每天固定时间":"Cron表达式"),1)]),createBaseVNode("div",_hoisted_42,[e[76]||(e[76]=createBaseVNode("span",{style:{color:"#6b7280"}},"运行时间：",-1)),createBaseVNode("span",null,toDisplayString(i.runType==="daily"?i.runTime:i.cronExpression),1)]),createBaseVNode("div",_hoisted_43,[e[77]||(e[77]=createBaseVNode("span",{style:{color:"#6b7280"}},"下次执行：",-1)),createBaseVNode("span",{style:normalizeStyle({fontWeight:"bold",color:(b=taskCountdowns.value[i.id])!=null&&b.isNearExecution?"#ff4d4f":"#1677ff"})},toDisplayString(((y=taskCountdowns.value[i.id])==null?void 0:y.formatted)||"计算中..."),5)]),createBaseVNode("div",_hoisted_44,[e[78]||(e[78]=createBaseVNode("span",{style:{color:"#6b7280"}},"选中账号：",-1)),createBaseVNode("span",null,toDisplayString(i.selectedTokens.length)+" 个",1)]),createBaseVNode("div",_hoisted_45,[e[79]||(e[79]=createBaseVNode("span",{style:{color:"#6b7280"}},"选中任务：",-1)),createBaseVNode("span",null,toDisplayString(i.selectedTasks.length)+" 个",1)]),createBaseVNode("div",_hoisted_46,[createVNode(o,{size:"tiny",onClick:S=>editTask(i)},{default:withCtx(()=>[...e[80]||(e[80]=[createTextVNode(" 编辑 ",-1)])]),_:1},8,["onClick"]),createVNode(o,{size:"tiny",type:"error",onClick:S=>deleteTask(i.id)},{default:withCtx(()=>[...e[81]||(e[81]=[createTextVNode(" 删除 ",-1)])]),_:1},8,["onClick"])])])}),128)),scheduledTasks.value.length===0?(openBlock(),createElementBlock("div",_hoisted_47," 暂无定时任务 ")):createCommentVNode("",!0)])]),_:1},8,["show"]),createVNode(T,{show:showTaskModal.value,"onUpdate:show":e[30]||(e[30]=i=>showTaskModal.value=i),preset:"card",title:editingTask.value?"编辑定时任务":"新增定时任务",style:{width:"90%","max-width":"600px"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_48,[createBaseVNode("div",_hoisted_49,[createBaseVNode("div",_hoisted_50,[e[82]||(e[82]=createBaseVNode("label",{class:"setting-label"},"任务名称",-1)),createVNode(v,{value:taskForm.name,"onUpdate:value":e[23]||(e[23]=i=>taskForm.name=i),placeholder:"请输入任务名称"},null,8,["value"])]),createBaseVNode("div",_hoisted_51,[e[85]||(e[85]=createBaseVNode("label",{class:"setting-label"},"运行类型",-1)),createVNode(f,{value:taskForm.runType,"onUpdate:value":[e[24]||(e[24]=i=>taskForm.runType=i),resetRunType]},{default:withCtx(()=>[createVNode(w,{value:"daily"},{default:withCtx(()=>[...e[83]||(e[83]=[createTextVNode("每天固定时间",-1)])]),_:1}),createVNode(w,{value:"cron"},{default:withCtx(()=>[...e[84]||(e[84]=[createTextVNode("Cron表达式",-1)])]),_:1})]),_:1},8,["value"])]),taskForm.runType==="daily"?(openBlock(),createElementBlock("div",_hoisted_52,[e[86]||(e[86]=createBaseVNode("label",{class:"setting-label"},"运行时间",-1)),createVNode(L,{value:taskForm.runTime,"onUpdate:value":e[25]||(e[25]=i=>taskForm.runTime=i),format:"HH:mm"},null,8,["value"])])):createCommentVNode("",!0),taskForm.runType==="cron"?(openBlock(),createElementBlock("div",_hoisted_53,[e[87]||(e[87]=createBaseVNode("label",{class:"setting-label"},"Cron表达式",-1)),createVNode(v,{value:taskForm.cronExpression,"onUpdate:value":e[26]||(e[26]=i=>taskForm.cronExpression=i),placeholder:"请输入Cron表达式"},null,8,["value"])])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_54,[createBaseVNode("div",_hoisted_55,[e[90]||(e[90]=createBaseVNode("label",{class:"setting-label"},"选择账号",-1)),createVNode(s,{size:"small"},{default:withCtx(()=>[createVNode(o,{size:"small",onClick:selectAllTokens},{default:withCtx(()=>[...e[88]||(e[88]=[createTextVNode(" 全选 ",-1)])]),_:1}),createVNode(o,{size:"small",onClick:deselectAllTokens},{default:withCtx(()=>[...e[89]||(e[89]=[createTextVNode(" 全不选 ",-1)])]),_:1})]),_:1})]),createVNode(l,{value:taskForm.selectedTokens,"onUpdate:value":e[27]||(e[27]=i=>taskForm.selectedTokens=i)},{default:withCtx(()=>[createVNode(c,{cols:2,"x-gap":12,"y-gap":8},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(tokens.value,i=>(openBlock(),createBlock(r,{key:i.id},{default:withCtx(()=>[createVNode(n,{value:i.id},{default:withCtx(()=>[createTextVNode(toDisplayString(i.name),1)]),_:2},1032,["value"])]),_:2},1024))),128))]),_:1})]),_:1},8,["value"])]),createBaseVNode("div",_hoisted_56,[createBaseVNode("div",_hoisted_57,[e[93]||(e[93]=createBaseVNode("label",{class:"setting-label"},"选择任务",-1)),createVNode(s,{size:"small"},{default:withCtx(()=>[createVNode(o,{size:"small",onClick:selectAllTasks},{default:withCtx(()=>[...e[91]||(e[91]=[createTextVNode(" 全选 ",-1)])]),_:1}),createVNode(o,{size:"small",onClick:deselectAllTasks},{default:withCtx(()=>[...e[92]||(e[92]=[createTextVNode(" 全不选 ",-1)])]),_:1})]),_:1})]),createVNode(l,{value:taskForm.selectedTasks,"onUpdate:value":e[28]||(e[28]=i=>taskForm.selectedTasks=i)},{default:withCtx(()=>[createVNode(c,{cols:2,"x-gap":12,"y-gap":8},{default:withCtx(()=>[(openBlock(),createElementBlock(Fragment,null,renderList(availableTasks,i=>createVNode(r,{key:i.value},{default:withCtx(()=>[createVNode(n,{value:i.value},{default:withCtx(()=>[createTextVNode(toDisplayString(i.label),1)]),_:2},1032,["value"])]),_:2},1024)),64))]),_:1})]),_:1},8,["value"])])]),createBaseVNode("div",_hoisted_58,[createVNode(o,{onClick:e[29]||(e[29]=i=>showTaskModal.value=!1),style:{"margin-right":"12px"}},{default:withCtx(()=>[...e[94]||(e[94]=[createTextVNode("取消",-1)])]),_:1}),createVNode(o,{type:"primary",onClick:saveTask},{default:withCtx(()=>[...e[95]||(e[95]=[createTextVNode("保存",-1)])]),_:1})])])]),_:1},8,["show","title"])])}}},BatchDailyTasks=_export_sfc(_sfc_main,[["__scopeId","data-v-b15ca517"]]);export{BatchDailyTasks as default};
