import{T as lt,H as $e}from"./ThemeToggle-DQaWFXx2.js";import{k as ze,S as $,U as v,a3 as it,V as u,r as h,w as Se,c as ut,e as dt,o as ct,Z as s,Y as S,X as U,$ as n,N as d,W as x,F as Ue,R as Me,L as Ae,ag as mt,j as m,a2 as _,a0 as M,a4 as Y,m as A}from"./vue-vendor-CjWJpnUV.js";import{_ as pt}from"./xiaoyugan-Dwisk7G8.js";import vt from"./manual-BZOVq2EX.js";import ft from"./url-C1Mr_lFd.js";import kt from"./bin-IuckmPD9.js";import{u as gt,s as oe}from"./index-DyiAMGIZ.js";import{_ as Tt}from"./plugin-vueexport-helper-DlAUqK2U.js";import{u as yt,a as wt,M as _t,C as bt,E as ht,N as T,B as Ct,S as xt,T as $t,b as St}from"./ui-vendor-bYSxkbvo.js";import{A as De}from"./Add-Cfs4ZWp-.js";import{M as Ut}from"./Menu-CRkbBSGB.js";import{C as se,S as Mt,T as At}from"./TrashBin-C9UW3eMC.js";import{R as ne}from"./Refresh-DEl0-b7R.js";import{E as Ee}from"./EllipsisHorizontal-DSgZjaEv.js";import{C as Dt}from"./Copy-By9v4eRW.js";import"./AlertCircleOutline-C052Kwii.js";import"./CloudUpload-jfh8uwlP.js";import"./utils-C42QaX6I.js";const Et={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Lt=it('<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 144h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 256h288"></path><path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="48" d="M160 368h288"></path><circle cx="80" cy="144" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="256" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle><circle cx="80" cy="368" r="16" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="32"></circle>',6),zt=[Lt],It=ze({name:"List",render:function(f,E){return v(),$("svg",Et,zt)}}),Pt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 512 512"},Bt=u("path",{d:"M394 480a16 16 0 0 1-9.39-3L256 383.76L127.39 477a16 16 0 0 1-24.55-18.08L153 310.35L23 221.2a16 16 0 0 1 9-29.2h160.38l48.4-148.95a16 16 0 0 1 30.44 0l48.4 149H480a16 16 0 0 1 9.05 29.2L359 310.35l50.13 148.53A16 16 0 0 1 394 480z",fill:"currentColor"},null,-1),Rt=[Bt],Le=ze({name:"Star",render:function(f,E){return v(),$("svg",Pt,Rt)}}),Wt={class:"token-import-page"},jt={class:"container"},Nt={class:"page-header"},Ft={class:"header-content"},Ot={class:"header-top"},Vt={class:"card-header"},Kt={class:"card-body"},Ht={key:0,class:"tokens-section"},Jt={class:"section-header"},qt={class:"header-actions"},Gt={key:0,class:"tokens-grid"},Xt={class:"token-display"},Yt={class:"token-value"},Zt=["onClick"],Qt={class:"remark-value"},eo={class:"token-timestamps"},to={class:"timestamp-item"},oo={class:"timestamp-value"},so={class:"timestamp-item"},no={class:"timestamp-value"},ro={class:"storage-info"},ao={class:"storage-item"},lo={key:0,class:"storage-upgrade"},io={key:1,class:"tokens-list"},uo={style:{"min-width":"65px"}},co={style:{"min-width":"100px"}},mo={style:{display:"flex","align-items":"center","flex-wrap":"wrap",gap:"2px"}},po={style:{"font-weight":"bold","font-size":"0.95em"}},vo=["onClick"],fo={class:"modal-actions"},ko={__name:"index",props:{token:String,name:String,server:String,wsUrl:String,api:String,auto:Boolean},setup(Z){const f=Z,E=mt(),r=yt(),I=wt(),l=gt(),C=h(!1),re=h(!1),W=h(!1);h(null),h(null);const Q=h(null),V=h(null),P=h("manual"),K=h(new Set),ae=h(new Set),H=h(localStorage.getItem("tokenViewMode")||"list"),B=h(null),D=h(null),R=h({});Se(H,t=>{localStorage.setItem("tokenViewMode",t)});const le=localStorage.getItem("tokenSortConfig"),b=h(le?JSON.parse(le):{field:"createdAt",direction:"asc"}),ie=ut(()=>[...l.gameTokens].sort((t,e)=>{var g,k,y,p,X,L;let a,i;switch(b.value.field){case"name":a=((g=t.name)==null?void 0:g.toLowerCase())||"",i=((k=e.name)==null?void 0:k.toLowerCase())||"";break;case"server":a=((y=t.server)==null?void 0:y.toLowerCase())||"",i=((p=e.server)==null?void 0:p.toLowerCase())||"";break;case"createdAt":a=new Date(t.createdAt||0).getTime(),i=new Date(e.createdAt||0).getTime();break;case"lastUsed":a=new Date(t.lastUsed||0).getTime(),i=new Date(e.lastUsed||0).getTime();break;default:a=((X=t.name)==null?void 0:X.toLowerCase())||"",i=((L=e.name)==null?void 0:L.toLowerCase())||""}return a<i?b.value.direction==="asc"?-1:1:a>i?b.value.direction==="asc"?1:-1:0})),J=t=>{b.value.field===t?b.value.direction=b.value.direction==="asc"?"desc":"asc":(b.value.field=t,b.value.direction="asc"),localStorage.setItem("tokenSortConfig",JSON.stringify(b.value))},q=t=>b.value.field!==t?null:b.value.direction==="asc"?"↑":"↓",ue=(t,e)=>{B.value=t,e.dataTransfer.effectAllowed="move"},de=t=>{t.preventDefault(),t.dataTransfer.dropEffect="move"},ce=(t,e)=>{if(e.preventDefault(),B.value===null||B.value===t)return;const a=[...l.gameTokens],i=a[B.value];a.splice(B.value,1),a.splice(t,0,i),l.gameTokens=a,B.value=null,r.success("Token 顺序已更新")},w=dt({name:"",token:"",server:"",wsUrl:"",remark:""}),Ie={name:[{required:!0,message:"请输入Token名称",trigger:"blur"}],token:[{required:!0,message:"请输入Token字符串",trigger:"blur"}]},Pe=[{label:"刷新所有Token",key:"refreshAll"},{label:"更新token信息",key:"updateInfo"},{label:"导出所有Token",key:"export"},{label:"导入Token文件",key:"import"},{label:"清理过期Token",key:"clean"},{label:"断开所有连接",key:"disconnect"},{label:"清除所有Token",key:"clear"}],Be=()=>{C.value=!0},j=async t=>{K.value.add(t.id);try{if(t.sourceUrl){let e;if(t.sourceUrl.startsWith(window.location.origin)||t.sourceUrl.startsWith("/")||t.sourceUrl.startsWith("http://localhost")||t.sourceUrl.startsWith("http://127.0.0.1"))e=await fetch(t.sourceUrl);else try{e=await fetch(t.sourceUrl,{method:"GET",headers:{Accept:"application/json"},mode:"cors"})}catch(g){throw new Error(`跨域请求被阻止。请确保目标服务器支持CORS。错误详情: ${g.message}`)}if(!e.ok)throw new Error(`请求失败: ${e.status} ${e.statusText}`);const i=await e.json();if(!i.token)throw new Error("返回数据中未找到token字段");l.updateToken(t.id,{token:i.token,server:i.server||t.server,lastRefreshed:Date.now()}),r.success("Token刷新成功")}else{I.info({title:"重新获取Token",content:`Token "${t.name}" 是手动导入的，没有配置自动刷新地址。

请选择以下操作：
1. 重新手动导入新的Token
2. 尝试重新连接现有Token`,positiveText:"重新导入",negativeText:"重新连接",onPositiveClick:()=>{C.value=!0,P.value="manual",importForm.name=t.name,importForm.server=t.server,importForm.wsUrl=t.wsUrl},onNegativeClick:()=>{l.getWebSocketStatus(t.id)==="connected"&&l.closeWebSocketConnection(t.id),setTimeout(()=>{l.createWebSocketConnection(t.id,t.token,t.wsUrl),r.info("正在尝试重新连接...")},500)}});return}l.getWebSocketStatus(t.id)==="connected"&&(l.closeWebSocketConnection(t.id),setTimeout(()=>{l.createWebSocketConnection(t.id,t.token,t.wsUrl)},500))}catch(e){console.error("刷新Token失败:",e),r.error(e.message||"Token刷新失败")}finally{K.value.delete(t.id)}},me=t=>{I.warning({title:"升级为长期有效",content:`确认要将Token "${t.name}" 升级为长期有效吗？升级后该Token将不会因24小时未使用而被自动清理。`,positiveText:"确认升级",negativeText:"取消",onPositiveClick:()=>{l.upgradeTokenToPermanent(t.id)?r.success(`Token "${t.name}" 已升级为长期有效！`):r.error("升级失败，该Token可能已经是长期有效状态")}})},pe=(t,e=!1)=>{if(D.value){ye();return}const a=oe.value===t.id,i=N(t.id);if(a&&i==="connected"&&!e){l.closeWebSocketConnection(t.id),r.success(`已断开 ${t.name} 的连接`);return}if(!a&&i==="connected"&&!e){l.closeWebSocketConnection(t.id),r.success(`已断开 ${t.name} 的连接`);return}if(a&&i==="connecting"&&!e){r.info(`${t.name} 正在连接中...`);return}l.selectToken(t.id,e)?e?r.success(`强制重连：${t.name}`):a?r.success(`重新连接：${t.name}`):r.success(`已选择：${t.name}`):r.error(`选择Token失败：${t.name}`)},N=t=>l.getWebSocketStatus(t),ve=t=>{const e=N(t);return{connected:"已连接",connecting:"连接中...",disconnected:"已断开",error:"连接错误",disconnecting:"断开中..."}[e]||"未连接"},fe=t=>{const e=N(t);return{connected:"success",connecting:"warning",disconnected:"danger",error:"danger",disconnecting:"warning"}[e]||"danger"},Re=t=>N(t)==="connected"?"success":"error",We=t=>N(t)==="connected"?"green":"red",ke=t=>{const e=[{label:"编辑",key:"edit",icon:()=>A(T,null,{default:()=>A(se)})},{label:"复制Token",key:"copy",icon:()=>A(T,null,{default:()=>A(Dt)})}];return t.importMethod==="url"&&t.sourceUrl?e.push({label:"从URL刷新",key:"refresh-url",icon:()=>A(T,null,{default:()=>A(Mt)})}):e.push({label:"重新获取",key:"refresh",icon:()=>A(T,null,{default:()=>A(ne)})}),e.push({type:"divider"},{label:"删除",key:"delete",icon:()=>A(T,null,{default:()=>A(At)}),props:{style:{color:"#e74c3c"}}}),e},ge=async(t,e)=>{switch(t){case"edit":je(e);break;case"copy":Fe(e);break;case"refresh":j(e);break;case"refresh-url":j(e);break;case"delete":Oe(e);break}},je=t=>{V.value=t,Object.assign(w,{name:t.name,token:t.token,server:t.server||"",wsUrl:t.wsUrl||"",remark:t.remark||""}),W.value=!0},Ne=async()=>{if(!(!Q.value||!V.value))try{await Q.value.validate(),l.updateToken(V.value.id,{name:w.name,token:w.token,server:w.server,wsUrl:w.wsUrl,remark:w.remark}),r.success("Token信息已更新"),W.value=!1,V.value=null}catch{}},Fe=async t=>{try{await navigator.clipboard.writeText(t.token),r.success("Token已复制到剪贴板")}catch{r.error("复制失败")}},Te=t=>{D.value=t.id,R.value[t.id]=t.remark||""},ye=()=>{if(!D.value)return;const t=D.value,e=R.value[t]||"";l.updateToken(t,{remark:e}),D.value=null,r.success("备注已保存")},G=t=>{ye()},we=()=>{D.value=null},Oe=t=>{I.warning({title:"删除Token",content:`确定要删除Token "${t.name}" 吗？此操作无法恢复。`,positiveText:"确定删除",negativeText:"取消",onPositiveClick:()=>{l.removeToken(t.id),r.success("Token已删除")}})},Ve=async()=>{if(!l.gameTokens.length){r.warning("没有可刷新的Token");return}const t=l.gameTokens.filter(a=>a.sourceUrl),e=l.gameTokens.filter(a=>!a.sourceUrl);if(t.length===0){r.warning("没有支持自动刷新的Token");return}I.warning({title:"批量刷新Token",content:"确定要刷新所有支持自动刷新的Token吗?",positiveText:"开始刷新",negativeText:"取消",onPositiveClick:async()=>{try{let a=0,i=0;const g=r.loading(`正在批量刷新Token (0/${t.length})`,{duration:0});for(let k=0;k<t.length;k++){const y=t[k];try{g.content=`正在刷新Token (${k+1}/${t.length}): ${y.name}`,await j(y),a++}catch(p){console.error(`刷新Token "${y.name}" 失败:`,p),i++}k<t.length-1&&await new Promise(p=>setTimeout(p,500))}g.destroy(),i===0?r.success(`批量刷新完成！成功刷新 ${a} 个Token`):r.warning(`批量刷新完成，成功 ${a} 个，失败 ${i} 个`),e.length>0&&r.info(`${e.length} 个手动导入的Token需要手动刷新`)}catch(a){r.error("批量刷新过程中发生错误: "+a.message)}}})},Ke=t=>{switch(t){case"refreshAll":Ve();break;case"updateInfo":Ye();break;case"export":He();break;case"import":Je();break;case"clean":qe();break;case"disconnect":Ge();break;case"clear":Xe();break}},He=()=>{try{const t=l.exportTokens(),e=JSON.stringify(t,null,2),a=new Blob([e],{type:"application/json"}),i=document.createElement("a");i.href=URL.createObjectURL(a),i.download=`tokens_backup_${new Date().toISOString().split("T")[0]}.json`,i.click(),r.success("Token数据已导出")}catch{r.error("导出失败")}},Je=()=>{const t=document.createElement("input");t.type="file",t.accept=".json",t.onchange=e=>{const a=e.target.files[0];if(a){const i=new FileReader;i.onload=g=>{try{const k=JSON.parse(g.target.result),y=l.importTokens(k);y.success?r.success(y.message):r.error(y.message)}catch{r.error("文件格式错误")}},i.readAsText(a)}},t.click()},qe=()=>{const t=l.cleanExpiredTokens();r.success(`已清理 ${t} 个过期Token`)},Ge=()=>{l.gameTokens.forEach(t=>{l.closeWebSocketConnection(t.id)}),r.success("所有连接已断开")},Xe=()=>{I.error({title:"清除所有Token",content:"确定要清除所有Token吗？此操作无法恢复！",positiveText:"确定清除",negativeText:"取消",onPositiveClick:()=>{l.clearAllTokens(),r.success("所有Token已清除")}})},Ye=async()=>{if(l.gameTokens.length===0){r.warning("没有可更新的Token");return}I.warning({title:"更新所有Token信息",content:`此操作将逐个连接所有Token，获取最新的角色名称和服务器信息，完成后自动断开连接。

预计耗时：约3-5秒/个Token`,positiveText:"开始更新",negativeText:"取消",onPositiveClick:async()=>{try{let t=0,e=0;const a=l.gameTokens.length,i=r.loading(`正在更新Token信息 (0/${a})`,{duration:0});for(let g=0;g<l.gameTokens.length;g++){const k=l.gameTokens[g];i.content=`正在更新Token信息 (${g+1}/${a}): ${k.name}`;try{await l.selectToken(k.id),await new Promise(y=>setTimeout(y,1e3)),l.closeWebSocketConnection(k.id),t++,r.success(`Token "${k.name}" 信息更新成功`)}catch(y){console.error(`更新Token "${k.name}" 失败:`,y),e++,r.error(`Token "${k.name}" 信息更新失败`)}g<l.gameTokens.length-1&&await new Promise(y=>setTimeout(y,500))}i.destroy(),e===0?r.success(`所有Token信息更新完成！成功更新 ${t} 个Token`):r.warning(`Token信息更新完成，成功 ${t} 个，失败 ${e} 个`)}catch(t){r.error("更新过程中发生错误: "+t.message)}}})},Ze=t=>{if(!t)return"";const e=t.length;return e<=8?t:t.substring(0,4)+"***"+t.substring(e-4)},_e=t=>new Date(t).toLocaleString("zh-CN"),Qe=()=>{E.push("/admin/batch-daily-tasks")},be=t=>{l.selectToken(t.id),r.success(`正在进入 ${t.name} 的控制台`),E.push("/admin/dashboard")},he=async()=>{if(f.token||f.api)try{re.value=!0;let t=null;if(f.api){r.info("正在从API获取token...");const e=await fetch(f.api,{method:"GET",headers:{Accept:"application/json"},mode:"cors"});if(!e.ok)throw new Error(`API请求失败: ${e.status} ${e.statusText}`);const a=await e.json();if(!a.token)throw new Error("API返回数据中未找到token字段");t=l.importBase64Token(f.name||a.name||"通过API导入的Token",a.token,{server:f.server||a.server,wsUrl:f.wsUrl,sourceUrl:f.api,importMethod:"url"})}else f.token&&(r.info("正在导入token..."),t=l.importBase64Token(f.name||"通过URL导入的Token",f.token,{server:f.server,wsUrl:f.wsUrl,importMethod:"url"}));if(t&&t.success)r.success(`Token "${t.tokenName}" 导入成功！`),f.auto&&t.token?(l.selectToken(t.token.id),r.success("正在跳转到控制台..."),setTimeout(()=>{E.push("/admin/dashboard")},1500)):E.replace("/tokens");else throw new Error((t==null?void 0:t.message)||"Token导入失败")}catch(t){console.error("URL参数处理失败:",t),r.error(`导入失败: ${t.message}`),E.replace("/tokens")}finally{re.value=!1}};return Se(()=>[f.token,f.api],he,{immediate:!1}),ct(async()=>{l.initTokenStore(),await he(),!l.hasTokens&&!f.token&&!f.api&&(C.value=!0)}),(t,e)=>{const a=lt,i=x("n-radio-button"),g=x("n-radio-group"),k=_t,y=x("n-divider"),p=x("n-button"),X=x("n-button-group"),L=x("n-space"),ee=x("n-dropdown"),et=$t,Ce=St,tt=xt,z=x("n-input"),xe=Ct,te=x("n-tag"),ot=bt,st=x("n-card"),nt=ht,F=x("n-form-item"),rt=x("n-form"),at=x("n-modal");return v(),$("div",Wt,[u("div",jt,[u("div",Nt,[u("div",Ft,[u("div",Ot,[e[28]||(e[28]=u("img",{src:pt,alt:"XYZW",class:"brand-logo"},null,-1)),s(a)]),e[29]||(e[29]=u("h1",null,"游戏Token管理",-1))])]),s(k,{class:"token-import-modal",visible:C.value,"onUpdate:visible":e[7]||(e[7]=o=>C.value=o),width:"40rem",footer:!1,"default-visible":!d(l).hasTokens},{title:n(()=>[u("h2",null,[s(d(T),null,{default:n(()=>[s(d(De))]),_:1}),e[30]||(e[30]=m(" 添加游戏Token ",-1))])]),default:n(()=>[u("div",Vt,[s(g,{value:P.value,"onUpdate:value":e[0]||(e[0]=o=>P.value=o),class:"import-method-tabs",size:"small"},{default:n(()=>[s(i,{value:"manual"},{default:n(()=>[...e[31]||(e[31]=[m(" 手动输入 ",-1)])]),_:1}),s(i,{value:"url"},{default:n(()=>[...e[32]||(e[32]=[m(" URL获取 ",-1)])]),_:1}),s(i,{value:"bin"},{default:n(()=>[...e[33]||(e[33]=[m(" BIN获取 ",-1)])]),_:1})]),_:1},8,["value"])]),u("div",Kt,[P.value==="manual"?(v(),U(vt,{key:0,onCancel:e[1]||(e[1]=()=>C.value=!1),onOk:e[2]||(e[2]=()=>C.value=!1)})):S("",!0),P.value==="url"?(v(),U(ft,{key:1,onCancel:e[3]||(e[3]=()=>C.value=!1),onOk:e[4]||(e[4]=()=>C.value=!1)})):S("",!0),P.value==="bin"?(v(),U(kt,{key:2,onCancel:e[5]||(e[5]=()=>C.value=!1),onOk:e[6]||(e[6]=()=>C.value=!1)})):S("",!0)])]),_:1},8,["visible","default-visible"]),d(l).hasTokens?(v(),$("div",Ht,[u("div",Jt,[s(L,{align:"center"},{default:n(()=>[u("h2",null,"我的Token列表 ("+_(d(l).gameTokens.length)+"个)",1),s(g,{value:H.value,"onUpdate:value":e[8]||(e[8]=o=>H.value=o),size:"small"},{default:n(()=>[s(i,{value:"list"},{default:n(()=>[...e[34]||(e[34]=[m("列表",-1)])]),_:1}),s(i,{value:"card"},{default:n(()=>[...e[35]||(e[35]=[m("卡片",-1)])]),_:1})]),_:1},8,["value"]),s(y,{vertical:"",style:{height:"24px"}}),s(X,{size:"small"},{default:n(()=>[s(p,{onClick:e[9]||(e[9]=o=>J("name")),type:b.value.field==="name"?"primary":"default"},{default:n(()=>[m(" 名称 "+_(q("name")),1)]),_:1},8,["type"]),s(p,{onClick:e[10]||(e[10]=o=>J("server")),type:b.value.field==="server"?"primary":"default"},{default:n(()=>[m(" 服务器 "+_(q("server")),1)]),_:1},8,["type"]),s(p,{onClick:e[11]||(e[11]=o=>J("createdAt")),type:b.value.field==="createdAt"?"primary":"default"},{default:n(()=>[m(" 创建时间 "+_(q("createdAt")),1)]),_:1},8,["type"]),s(p,{onClick:e[12]||(e[12]=o=>J("lastUsed")),type:b.value.field==="lastUsed"?"primary":"default"},{default:n(()=>[m(" 最后使用 "+_(q("lastUsed")),1)]),_:1},8,["type"])]),_:1})]),_:1}),u("div",qt,[s(p,{type:"success",onClick:Qe},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d(It))]),_:1})]),default:n(()=>[e[36]||(e[36]=m(" 批量功能 ",-1))]),_:1}),C.value?S("",!0):(v(),U(p,{key:0,type:"primary",onClick:e[13]||(e[13]=o=>C.value=!0)},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d(De))]),_:1})]),default:n(()=>[e[37]||(e[37]=m(" 添加Token ",-1))]),_:1})),s(ee,{options:Pe,onSelect:Ke},{default:n(()=>[s(p,null,{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d(Ut))]),_:1})]),default:n(()=>[e[38]||(e[38]=m(" 批量操作 ",-1))]),_:1})]),_:1})])]),H.value==="card"?(v(),$("div",Gt,[(v(!0),$(Ue,null,Me(d(ie),(o,O)=>(v(),U(ot,{key:o.id,draggable:"true",onDragstart:c=>ue(O,c),onDragover:e[16]||(e[16]=c=>de(c)),onDrop:c=>ce(O,c),class:Ae({"token-card":!0,active:d(oe)===o.id}),onClick:c=>pe(o)},{title:n(()=>[s(tt,{class:"token-name"},{default:n(()=>[m(_(o.name)+" ",1),o.server?(v(),U(et,{key:0,color:We(o.id)},{default:n(()=>[m(_(o.server),1)]),_:2},1032,["color"])):S("",!0),s(Ce,{status:fe(o.id),text:ve(o.id)},null,8,["status","text"])]),_:2},1024)]),extra:n(()=>[s(ee,{options:ke(o),onSelect:c=>ge(c,o)},{default:n(()=>[s(p,{text:""},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d(Ee))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),default:n(()=>[u("div",Xt,[e[39]||(e[39]=u("span",{class:"token-label"},"Token:",-1)),u("code",Yt,_(Ze(o.token)),1)]),D.value===o.id?(v(),$("div",{key:0,class:"token-remark token-remark-edit",onClick:e[15]||(e[15]=M(()=>{},["stop"]))},[e[40]||(e[40]=u("span",{class:"remark-label"},"备注：",-1)),s(z,{value:R.value[o.id],"onUpdate:value":c=>R.value[o.id]=c,type:"textarea",rows:2,placeholder:"添加备注信息...",onBlur:c=>G(o),onKeyup:[Y(c=>G(o),["enter"]),e[14]||(e[14]=Y(c=>we(),["esc"]))],autofocus:""},null,8,["value","onUpdate:value","onBlur","onKeyup"])])):(v(),$("div",{key:1,class:"token-remark",onClick:M(c=>Te(o),["stop"])},[e[41]||(e[41]=u("span",{class:"remark-label"},"备注：",-1)),u("span",Qt,_(o.remark||"点击添加备注"),1),s(d(T),{style:{"margin-left":"4px",color:"var(--text-tertiary)"}},{default:n(()=>[s(d(se))]),_:1})],8,Zt)),s(xe,{loading:K.value.has(o.id),onClick:M(c=>j(o),["stop"])},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d(ne))]),_:1})]),default:n(()=>[m(" "+_(o.sourceUrl?"刷新":"重新获取"),1)]),_:2},1032,["loading","onClick"]),u("div",eo,[u("div",to,[e[42]||(e[42]=u("span",{class:"timestamp-label"},"创建：",-1)),u("span",oo,_(_e(o.createdAt)),1)]),u("div",so,[e[43]||(e[43]=u("span",{class:"timestamp-label"},"使用：",-1)),u("span",no,_(_e(o.lastUsed)),1)])]),u("div",ro,[u("div",ao,[e[44]||(e[44]=u("span",{class:"storage-label"},"存储类型：",-1)),s(te,{size:"small",type:o.importMethod==="url"||o.importMethod==="bin"||o.upgradedToPermanent?"success":"warning"},{default:n(()=>[m(_(o.importMethod==="url"||o.importMethod==="bin"||o.upgradedToPermanent?"长期有效":"临时存储"),1)]),_:2},1032,["type"])]),o.importMethod==="url"||o.importMethod==="bin"||o.upgradedToPermanent?S("",!0):(v(),$("div",lo,[s(p,{size:"tiny",type:"success",ghost:"",onClick:M(c=>me(o),["stop"])},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d(Le))]),_:1})]),default:n(()=>[e[45]||(e[45]=m(" 升级为长期有效 ",-1))]),_:1},8,["onClick"])]))])]),actions:n(()=>[s(p,{type:"primary",size:"large",block:"",loading:ae.value.has(o.id),onClick:c=>be(o)},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d($e))]),_:1})]),default:n(()=>[e[46]||(e[46]=m(" 进入控制台 ",-1))]),_:1},8,["loading","onClick"])]),_:2},1032,["onDragstart","onDrop","class","onClick"]))),128))])):(v(),$("div",io,[(v(!0),$(Ue,null,Me(d(ie),(o,O)=>(v(),U(st,{key:o.id,draggable:"true",onDragstart:c=>ue(O,c),onDragover:e[20]||(e[20]=c=>de(c)),onDrop:c=>ce(O,c),size:"small",style:{"margin-bottom":"8px"},hoverable:"",onClick:c=>pe(o),class:Ae({active:d(oe)===o.id})},{default:n(()=>[s(L,{justify:"space-between",align:"center"},{default:n(()=>[s(L,{align:"center",size:6},{default:n(()=>[u("div",uo,[s(Ce,{status:fe(o.id),text:ve(o.id)},null,8,["status","text"])]),u("div",co,[u("div",mo,[u("span",po,_(o.name),1),o.server?(v(),U(te,{key:0,size:"small",type:Re(o.id)},{default:n(()=>[m(_(o.server),1)]),_:2},1032,["type"])):S("",!0),D.value===o.id?(v(),$("div",{key:1,style:{"font-size":"0.75em",display:"flex","align-items":"center",gap:"4px"},onClick:e[18]||(e[18]=M(()=>{},["stop"]))},[e[47]||(e[47]=u("i",{class:"i-mdi:note-outline",style:{"margin-right":"1px"}},null,-1)),s(z,{value:R.value[o.id],"onUpdate:value":c=>R.value[o.id]=c,size:"small",placeholder:"添加备注...",onBlur:c=>G(o),onKeyup:[Y(c=>G(o),["enter"]),e[17]||(e[17]=Y(c=>we(),["esc"]))],autofocus:"",style:{width:"150px"}},null,8,["value","onUpdate:value","onBlur","onKeyup"])])):(v(),$("div",{key:2,style:{"font-size":"0.75em",color:"var(--text-secondary)","white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis",cursor:"pointer",display:"flex","align-items":"center",gap:"4px"},onClick:M(c=>Te(o),["stop"])},[e[48]||(e[48]=u("i",{class:"i-mdi:note-outline",style:{"margin-right":"1px"}},null,-1)),m(" "+_(o.remark||"点击添加备注")+" ",1),s(d(T),{style:{"font-size":"0.8em",color:"var(--text-tertiary)"}},{default:n(()=>[s(d(se))]),_:1})],8,vo))])])]),_:2},1024),s(L,null,{default:n(()=>[s(te,{size:"small",type:o.importMethod==="url"||o.importMethod==="bin"||o.upgradedToPermanent?"success":"warning"},{default:n(()=>[m(_(o.importMethod==="url"||o.importMethod==="bin"||o.upgradedToPermanent?"长期":"临时"),1)]),_:2},1032,["type"]),o.importMethod==="url"||o.importMethod==="bin"||o.upgradedToPermanent?S("",!0):(v(),U(p,{key:0,size:"small",type:"success",ghost:"",onClick:M(c=>me(o),["stop"])},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d(Le))]),_:1})]),default:n(()=>[e[49]||(e[49]=m(" 升级 ",-1))]),_:1},8,["onClick"])),s(p,{size:"small",type:"primary",loading:ae.value.has(o.id),onClick:M(c=>be(o),["stop"])},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d($e))]),_:1})]),default:n(()=>[e[50]||(e[50]=m(" 控制台 ",-1))]),_:1},8,["loading","onClick"]),s(p,{size:"small",onClick:M(c=>j(o),["stop"]),loading:K.value.has(o.id)},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d(ne))]),_:1})]),default:n(()=>[e[51]||(e[51]=m(" 刷新 ",-1))]),_:1},8,["onClick","loading"]),s(ee,{options:ke(o),onSelect:c=>ge(c,o)},{default:n(()=>[s(p,{size:"small",circle:"",onClick:e[19]||(e[19]=M(()=>{},["stop"]))},{icon:n(()=>[s(d(T),null,{default:n(()=>[s(d(Ee))]),_:1})]),_:1})]),_:1},8,["options","onSelect"])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onDragstart","onDrop","onClick","class"]))),128))]))])):S("",!0),!d(l).hasTokens&&!C.value?(v(),U(nt,{key:1},{image:n(()=>[...e[52]||(e[52]=[u("i",{class:"mdi:bed-empty"},null,-1)])]),default:n(()=>[e[54]||(e[54]=m(" 还没有导入任何Token ",-1)),s(xe,{type:"link",onClick:Be},{default:n(()=>[...e[53]||(e[53]=[m("打开Token管理",-1)])]),_:1})]),_:1})):S("",!0)]),s(at,{show:W.value,"onUpdate:show":e[27]||(e[27]=o=>W.value=o),preset:"card",title:"编辑Token",style:{width:"500px"}},{footer:n(()=>[u("div",fo,[s(p,{onClick:e[26]||(e[26]=o=>W.value=!1)},{default:n(()=>[...e[55]||(e[55]=[m(" 取消 ",-1)])]),_:1}),s(p,{type:"primary",onClick:Ne},{default:n(()=>[...e[56]||(e[56]=[m(" 保存 ",-1)])]),_:1})])]),default:n(()=>[s(rt,{ref_key:"editFormRef",ref:Q,model:w,rules:Ie,"label-placement":"left","label-width":"80px"},{default:n(()=>[s(F,{label:"名称",path:"name"},{default:n(()=>[s(z,{value:w.name,"onUpdate:value":e[21]||(e[21]=o=>w.name=o)},null,8,["value"])]),_:1}),s(F,{label:"Token字符串",path:"token"},{default:n(()=>[s(z,{value:w.token,"onUpdate:value":e[22]||(e[22]=o=>w.token=o),type:"textarea",rows:3,placeholder:"粘贴Token字符串...",clearable:""},null,8,["value"])]),_:1}),s(F,{label:"服务器"},{default:n(()=>[s(z,{value:w.server,"onUpdate:value":e[23]||(e[23]=o=>w.server=o)},null,8,["value"])]),_:1}),s(F,{label:"WebSocket地址"},{default:n(()=>[s(z,{value:w.wsUrl,"onUpdate:value":e[24]||(e[24]=o=>w.wsUrl=o)},null,8,["value"])]),_:1}),s(F,{label:"备注"},{default:n(()=>[s(z,{value:w.remark,"onUpdate:value":e[25]||(e[25]=o=>w.remark=o),type:"textarea",rows:2,placeholder:"添加备注信息..."},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show"])])}}},Io=Tt(ko,[["__scopeId","data-v-eb5088a1"]]);export{Io as default};
